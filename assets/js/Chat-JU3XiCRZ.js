import{a as N,r as l,o as ce,g as G,C,e as ye,b as we,c as ke,d as $e,f as ve,P as R,h as S,i as re,q as Me,j as B,p as be,k as ne,_ as ue,O as K,l as oe,m as X,v as Ce,s as ee,n as Ie,t as he,L as U,u as J,w as Se,x as _,y as Le,z as De,A as Be,I as Te,S as de,B as W,D as Fe,E as je,F as Ee,G as Ne}from"./main-BBXPicG1.js";import{d as O,z as D,l as h,A as r,q as i,H as w,k as m,x as d,p as f,U as me,E as I,I as b,v as M,F as $,D as L,S as q,O as Oe,R as Re,M as E,B as j,r as ae,C as se,J as Y,c as Pe,a as Ue,W as H,G as te,u as k,X as pe,P as qe,m as Q}from"./@vue-DQKBd11T.js";import{x as He}from"./xss-CRi1SGNr.js";import{_ as P,C as ge}from"./vue3-bcui-Bg9oGict.js";import{_ as ie,E as z,a as V}from"./MsgBody.vue_vue_type_style_index_0_lang-DMbbiuK_.js";import{v as le}from"./uuid-C_lTrkZC.js";import{i as Ae}from"./browser-image-compression-BzWLnoYn.js";import"./vue-clipboard2-BFQSVUs1.js";import"./@stapxs-CkoNcTI-.js";import"./axios-ivHLpVbm.js";import"./clipboard-9vdfq_hV.js";import"./spacingjs-Bfd_UwgF.js";import"./tiny-pinyin-D3NIDYMz.js";import"./jsonpath-C0MFlgnZ.js";import"./animejs-BNELU3II.js";import"./js-file-downloader-BzrZ6mtV.js";import"./semver-7XuC2Onc.js";import"./vconsole-Dm9_wc-u.js";import"./pofile-dQSnng0Z.js";import"./rollup-plugin-node-polyfills-CobtAncr.js";import"./vue3-danmaku-BPDoe8Jp.js";import"./detect-browser-ClY_l-h2.js";import"./vue-echarts-Dm_R2q5L.js";import"./echarts-DNjRdAaI.js";import"./zrender-BX6qrBMt.js";import"./@fortawesome-D823trmV.js";import"./pinia-Dq_Jg9CD.js";import"./vue-i18n-DUJN4i7f.js";import"./@intlify-QuXUtBBc.js";import"./cssfilter-BjxKUPhv.js";import"./markdown-it-C44Roubk.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-kMc2yuuw.js";import"./entities-C20TfXL6.js";import"./linkify-it-DmNjr4Kv.js";import"./punycode.js-Dj65hjkv.js";import"./vue3-lottie-BMDOfXta.js";import"./lottie-web-B0EgQ-Xw.js";const Ge=O({name:"BulletinBody",inject:["viewer"],props:["data","index"],data(){return{trueLang:G(),runtimeData:l,showAll:!1,needShow:!0}},mounted(){this.$nextTick(()=>{const e=document.getElementById("info-pan-notices"),t=document.getElementById("info-pan-mumber"),a=document.getElementById("bulletins-msg-"+this.index);if(a&&e&&t){e.click();const s=Number(getComputedStyle(a).maxHeight.replace("px","")),o=a.offsetHeight;t.click(),this.needShow=o==s}})},methods:{parseText(e){e=e.replaceAll("\r",`
`).replaceAll(`

`,`
`).replaceAll("&#10;",`
`),e=He(e,{whiteList:{a:["href","target"]}});const t=/(http|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-.,@?^=%&:/~+#]*[\w\-@?^=%&/~+#])?/gi;return e=e.replaceAll(t,'<a href="" data-link="$&" onclick="return false">$&</a>'),e},textClick(e){const t=e.target;if(t.dataset.link){const a=t.dataset.link;ce(a)}},getSenderName(){var a;const{$t:e}=N.config.globalProperties;return((a=l.chatInfo.info.group_members.filter(s=>Number(s.user_id)===Number(this.data.sender)).at(0))==null?void 0:a.nickname)??e("已退群( {userId} )",{userId:Number(this.data.sender)})},imgClick(e){this.viewer&&this.viewer.open(e)}}}),_e=["id"],We=["innerHTML"],ze=["src"],Ke={class:"info"},Ve=["src"],Je={key:0};function Qe(e,t,a,s,o,u){const p=D("font-awesome-icon");return r(),h("div",{class:"base",onClick:t[2]||(t[2]=n=>e.showAll=!e.showAll)},[i("header",null,[m(p,{icon:["fas","bookmark"]}),i("span",null,d(e.$t("公告")),1),t[3]||(t[3]=i("div",{style:{flex:"1"}},null,-1)),i("span",null,d(Intl.DateTimeFormat(e.trueLang,{month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format(e.data.time)),1)]),i("div",{id:"bulletins-msg-"+e.index,class:I("body"+(e.showAll?" all":""))},[i("span",{style:{"margin-right":"auto","margin-bottom":"auto"},onClick:t[0]||(t[0]=(...n)=>e.textClick&&e.textClick(...n)),innerHTML:e.parseText(e.data.content[0])},null,8,We),e.data.img?(r(),h("img",{key:0,src:e.data.img.src,class:I({img:!0,all:e.showAll}),onClick:t[1]||(t[1]=me(n=>e.imgClick(e.data.img),["stop"]))},null,10,ze)):f("",!0)],10,_e),w(i("span",null,d(e.$t("点击展开")),513),[[b,e.needShow&&!e.showAll]]),i("div",Ke,[i("img",{src:"https://q1.qlogo.cn/g?b=qq&s=0&nk="+e.data.sender},null,8,Ve),i("a",null,d(e.runtimeData.chatInfo.info.group_members.filter(n=>Number(n.user_id)===Number(e.data.sender))[0].nickname),1),t[4]||(t[4]=i("div",null,null,-1)),e.data.is_read?(r(),h("span",Je,d(e.$t("{readNum} 人已读 | {isRead}",{isRead:e.data.is_read?e.$t("已读"):e.$t("未读"),readNum:e.data.read_num})),1)):f("",!0)])])}const Ye=P(Ge,[["render",Qe]]),Xe=O({name:"FileBody",props:{item:{type:Object,required:!0},chat:{type:Object,required:!0},parent:{type:String,required:!1,default:void 0}},data(){return{trueLang:G(),getSize:we,toHtml:ye}},methods:{getFile(e){var a;const t=(a=l.jsonMap.file_download)==null?void 0:a.name;t&&(C.send(t,{group_id:l.chatInfo.show.id,file_id:e.file_id},"downloadGroupFile_"+e.file_id+"_"+btoa(encodeURIComponent(e.file_name))),e.download_percent=0)},loadFileDir(e){var s;const t=e.folder_id,a=(s=l.jsonMap.group_folder_files)==null?void 0:s.name;if(e.items!==void 0){e.show_items=!e.show_items;return}t&&a&&C.send(a,{folder_id:t,group_id:l.chatInfo.show.id},"getGroupDirFiles_"+t)}}}),Ze={class:"main"},xe={key:0},es={key:1},ss={key:2},ts={key:1,class:"download-bar",xmlns:"http://www.w3.org/2000/svg"},is=["stroke-dasharray"],ns={key:2,class:"download"};function os(e,t,a,s,o,u){const p=D("font-awesome-icon"),n=D("FileBody",!0);return r(),h("div",{class:I((e.item.folder_id?" folder":"")+(e.item.items&&e.item.items.length>0?" open":"")),onClick:t[1]||(t[1]=y=>e.loadFileDir(e.item))},[e.item.folder_id?(r(),M(p,{key:0,icon:["fas","folder"]})):(r(),M(p,{key:1,icon:["fas","file"]})),i("div",Ze,[i("span",null,d(e.toHtml(e.item.folder_name??e.item.file_name)),1),i("div",null,[i("span",null,d(e.toHtml(e.item.creater_name??e.item.uploader_name)),1),i("span",null,d(e.item.create_time||e.item.upload_time?Intl.DateTimeFormat(e.trueLang,{year:"numeric",month:"short",day:"numeric"}).format(new Date((e.item.create_time??e.item.upload_time)*1e3)):"-"),1),!e.item.dead_time&&e.item.dead_time?(r(),h("span",xe,d(e.item.dead_time-e.item.create_time/86400-1+e.$t("天后")),1)):f("",!0),e.item.folder_id?(r(),h("span",es,d(e.$t("共 {num} 个文件",{num:e.item.count})),1)):(r(),h("span",ss,d(e.getSize(e.item.size)),1))])]),e.item.file_id?(r(),h($,{key:2},[e.item.download_percent===void 0?(r(),h("div",{key:0,class:"download",onClick:t[0]||(t[0]=y=>e.getFile(e.item))},[m(p,{icon:["fas","angle-down"]})])):e.item.download_percent!==void 0&&e.item.download_percent<100?(r(),h("svg",ts,[t[2]||(t[2]=i("circle",{cx:"50%",cy:"50%",r:"40%","stroke-width":"15%",fill:"none","stroke-linecap":"round"},null,-1)),i("circle",{cx:"50%",cy:"50%",r:"40%","stroke-width":"15%",fill:"none","stroke-dasharray":e.item.download_percent===void 0?"0,10000":`${Math.floor(2*Math.PI*25)*e.item.download_percent/100},10000`},null,8,is)])):(r(),h("div",ns,[m(p,{icon:["fas","check"]})]))],64)):f("",!0),w(i("div",{class:I((e.item.items!==void 0?"sub_file ":"")+"group-files")},[(r(!0),h($,null,L(e.item.items,y=>(r(),h("div",{key:"sub_file-"+y.file_id},[m(n,{chat:e.chat,item:y,parent:e.item.folder_id},null,8,["chat","item","parent"])]))),128))],2),[[b,e.item.show_items!==!1&&e.item.items!==void 0]])],2)}const as=P(Xe,[["render",os]]),ls=O({name:"ViewOptInfo",props:["type","chat"],emits:["update_mumber_card"],data(){return{canGroupNotice:ve,runtimeData:l}},methods:{setGroupNotice(e){const t=e.target.checked;$e(this.chat.show.id,t)},setGroupCard(e){this.$emit("update_mumber_card",e,l.chatInfo.info.me_info)},setGroupName(e){e.key==="Enter"&&l.chatInfo.show.name!=""&&C.send("set_group_name",{group_id:this.chat.show.id,group_name:l.chatInfo.show.name},"setGroupName")},leaveGroup(){const e={html:"<span>"+this.$t("确定要退出群聊吗？")+"</span>",button:[{text:this.$t("确定"),fun:()=>{var t,a;(t=l.jsonMap.leave_group)!=null&&t.name&&C.send((a=l.jsonMap.leave_group)==null?void 0:a.name,{group_id:this.chat.show.id},"leaveGroup"),l.baseOnMsgList.delete(this.chat.show.id),l.chatInfo.show.id=0,ke(),l.popBoxList.shift()}},{text:this.$t("取消"),master:!0,fun:()=>{l.popBoxList.shift()}}]};l.popBoxList.push(e)}}}),rs={class:"info-pan-set",style:{padding:"0"}},ds={key:0,class:"opt-item"},us={class:"opt-item"},hs={class:"opt-item"},ms={class:"ss-switch"};function ps(e,t,a,s,o,u){const p=D("font-awesome-icon");return r(),h("div",rs,[e.type=="group"?(r(),h($,{key:0},[e.runtimeData.chatInfo.info.me_info.role=="owner"||e.runtimeData.chatInfo.info.me_info.role=="admin"?(r(),h("div",ds,[m(p,{icon:["fas","pen"]}),i("div",null,[i("span",null,d(e.$t("群聊名称")),1),i("span",null,d(e.$t("“你们真是害人不浅呐你们这个群”")),1)]),w(i("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>e.runtimeData.chatInfo.show.name=n),class:"ss-input",style:{width:"150px"},type:"text",onKeyup:t[1]||(t[1]=(...n)=>e.setGroupName&&e.setGroupName(...n))},null,544),[[q,e.runtimeData.chatInfo.show.name]])])):f("",!0),i("div",us,[m(p,{icon:["fas","note-sticky"]}),i("div",null,[i("span",null,d(e.$t("我的群昵称")),1),i("span",null,d(e.$t("￡爺↘僞ηι慹著彡")),1)]),w(i("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>e.runtimeData.chatInfo.info.me_info.card=n),class:"ss-input",style:{width:"150px"},type:"text",onChange:t[3]||(t[3]=(...n)=>e.setGroupCard&&e.setGroupCard(...n))},null,544),[[q,e.runtimeData.chatInfo.info.me_info.card]])]),i("div",hs,[m(p,{icon:["fas","bell"]}),i("div",null,[i("span",null,d(e.$t("通知群消息")),1),i("span",null,d(e.$t("快来水群快来水群！")),1)]),i("label",ms,[w(i("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>e.canGroupNotice=n),type:"checkbox",name:"opt_dark",onChange:t[5]||(t[5]=(...n)=>e.setGroupNotice&&e.setGroupNotice(...n))},null,544),[[Oe,e.canGroupNotice]]),t[7]||(t[7]=i("div",null,[i("div")],-1))])]),i("button",{class:"ss-button",style:{width:"calc(100% - 60px)",margin:"10px 30px 0 30px"},onClick:t[6]||(t[6]=n=>e.leaveGroup())},d(e.$t("退出群聊")),1)],64)):f("",!0)])}const gs=P(ls,[["render",ps],["__scopeId","data-v-e1d26f31"]]),fs=O({name:"ViewInfo",components:{BulletinBody:Ye,FileBody:as,OptInfo:gs,BcTab:ge},props:["tags","chat"],emits:["close"],data(){return{qqLevelToEmoji:Me,runtimeData:l,trueLang:G(),isTop:!1,number_cache:[],showUserConfig:{},showUserConfigRaw:{},mumberInfo:{banMin:0}}},methods:{removeUser(e,t,a){const s={title:this.$t("提醒"),html:`<span>${this.$t("真的要将 {user} 移出群聊吗",{user:e})}</span>`,button:[{text:N.config.globalProperties.$t("确定"),fun:()=>{C.send("set_group_kick",{group_id:t,user_id:a},"setGroupKick"),l.popBoxList.shift(),this.showUserConfig={};const o={title:this.$t("操作"),html:`<span>${this.$t("正在确认操作……")}</span>`};l.popBoxList.push(o),re(1e3).then(()=>(C.send("get_group_member_list",{group_id:l.chatInfo.show.id,no_cache:!0},"getGroupMemberList"),re(1e3))).then(()=>{C.send("get_group_member_list",{group_id:l.chatInfo.show.id,no_cache:!0},"getGroupMemberList"),l.popBoxList.shift()})}},{text:N.config.globalProperties.$t("取消"),master:!0,fun:()=>{l.popBoxList.shift()}}]};l.popBoxList.push(s)},copyText(e){const t=new R;N.config.globalProperties.$copyText(String(e)).then(()=>{t.add(S.INFO,this.$t("复制成功"),!0)},()=>{t.add(S.ERR,this.$t("复制失败"),!0)})},banMumber(e,t){const a=e.target.value;if(a!==""){const s=parseInt(a);if(s>0){const o={title:this.$t("操作"),html:`<span>${this.$t("确认禁言？")}</span>`,button:[{text:this.$t("确认"),fun:()=>{var p;const u=(p=l.jsonMap.ban_mumber)==null?void 0:p.name;u&&C.send(u,{group_id:l.chatInfo.show.id,user_id:t.user_id,duration:s*60},"banMumber"),l.popBoxList.shift(),this.closeChatInfoPan()}},{text:this.$t("取消"),master:!0,fun:()=>{this.showUserConfigRaw=JSON.parse(JSON.stringify(t)),l.popBoxList.shift()}}]};l.popBoxList.push(o)}}},updateMumberCard(e,t){const a=e.target.value;if(this.showUserConfig.card!==a){const s={title:this.$t("操作"),html:`<span>${this.$t("确认修改昵称？")}</span>`,button:[{text:this.$t("确认"),fun:()=>{var u;const o=(u=l.jsonMap.set_group_nickname)==null?void 0:u.name;o&&C.send(o,{group_id:l.chatInfo.show.id,user_id:t.user_id,card:a},"updateGroupMemberInfo"),l.popBoxList.shift(),this.closeChatInfoPan()}},{text:this.$t("取消"),master:!0,fun:()=>{this.showUserConfigRaw=JSON.parse(JSON.stringify(t)),l.popBoxList.shift()}}]};l.popBoxList.push(s)}},updateMumberTitle(e,t){const a=e.target.value;if(this.showUserConfig.card!==a){const s={title:this.$t("操作"),html:`<span>${this.$t("确认修改头衔？")}</span>`,button:[{text:this.$t("确认"),fun:()=>{var u;const o=(u=l.jsonMap.set_group_title)==null?void 0:u.name;o&&C.send(o,{group_id:l.chatInfo.show.id,user_id:t.user_id,special_title:a},"updateGroupMemberInfo"),l.popBoxList.shift(),this.closeChatInfoPan()}},{text:this.$t("取消"),master:!0,fun:()=>{this.showUserConfigRaw=JSON.parse(JSON.stringify(t)),l.popBoxList.shift()}}]};l.popBoxList.push(s)}},getBanTimeMin(e){e<1e10&&(e*=1e3);const t=new Date().getTime(),a=e-t;return a>0?Math.floor(a/1e3/60):0},checkNumber(e){const t=e.target.value;if(t!==""){const a=parseInt(t);isNaN(a)?e.target.value="":a<0&&(e.target.value="0")}},closeChatInfoPan(){this.showUserConfig={},this.$emit("close",null)},startChat(e){if(e.user_id!=l.loginInfo.uin){let t=l.userList.find(a=>a.user_id==e.user_id);t||(t={user_id:e.user_id,nickname:N.config.globalProperties.$t("临时会话"),remark:e.user_id,group_id:e.group_id,group_name:""}),l.baseOnMsgList.set(Number(e.user_id),t),this.$nextTick(()=>{if(t){const a=document.getElementById("user-"+t.user_id);a&&a.click()}})}},openMoreConfig(e){const t=this.chat.info.group_members.find(a=>a.user_id===e);t&&this.moreConfig(t)},moreConfig(e){this.canEditMember(e.role)?(this.showUserConfig=e,this.showUserConfigRaw=JSON.parse(JSON.stringify(e)),this.mumberInfo.banMin=this.getBanTimeMin(e.shut_up_timestamp)):this.copyText(e.user_id)},searchList(e){const t=e.target.value;t!==""?(this.number_cache=Re(this.chat.info.group_members),this.number_cache=this.number_cache.filter(a=>{const s=a.card.toLowerCase()+"("+a.nickname.toLowerCase()+")",o=a.user_id;return s.indexOf(t.toLowerCase())!=-1||o.toString()===t})):this.number_cache=[]},canEditMember(e){return this.chat.info.me_info.role==="owner"||this.chat.info.me_info.role==="admin"&&e!=="owner"}}}),cs={key:0,class:"chat-info-pan"},ys={class:"ss-card chat-info"},ws={key:0},ks={key:1},$s=["src"],vs={key:0},Ms=["innerHTML"],bs={class:"tags"},Cs={key:1},Is={key:0},Ss={key:1},Ls={key:2},Ds={key:3},Bs={class:"outher"},Ts={key:0},Fs={key:1},js=["name"],Es={class:"chat-info-tab-member"},Ns={class:"search-view"},Os=["placeholder"],Rs=["src"],Ps=["onClick"],Us=["onClick"],qs=["name"],Hs={class:"bulletins"},As={key:0,style:{"text-align":"center",padding:"20px",color:"var(--color-text-3)"}},Gs=["name"],_s={class:"group-files"},Ws={key:0,style:{"text-align":"center",padding:"20px",color:"var(--color-text-3)"}},zs=["name"],Ks={style:{padding:"0 20px"}},Vs=["src"],Js={class:"opt-item"},Qs={key:0,class:"opt-item"},Ys={class:"opt-item"};function Xs(e,t,a,s,o,u){const p=D("font-awesome-icon"),n=D("BulletinBody"),y=D("FileBody"),g=D("OptInfo"),v=D("BcTab");return e.tags.openChatInfo?(r(),h("div",cs,[i("div",ys,[i("header",null,[e.chat.show.type==="group"?(r(),h("span",ws,d(e.$t("群资料")),1)):f("",!0),e.chat.show.type==="user"?(r(),h("span",ks,d(e.$t("好友")),1)):f("",!0),m(p,{icon:["fas","xmark"],onClick:e.closeChatInfoPan},null,8,["onClick"])]),i("div",{class:I("chat-info-base "+e.chat.show.type)},[i("div",null,[i("img",{src:e.chat.show.avatar},null,8,$s),i("div",null,[i("a",null,d(e.chat.show.name),1),i("span",null,d(e.chat.show.id),1)]),i("div",{style:{display:"flex","align-items":"center","justify-content":"center",cursor:"pointer"},onClick:t[0]||(t[0]=c=>e.copyText(e.chat.show.id))},[m(p,{icon:["fas","copy"]})])]),e.chat.show.type==="group"?w((r(),h("div",vs,[i("header",null,[i("span",null,d(e.$t("介绍")),1)]),i("span",{innerHTML:e.chat.info.group_info.gIntro===void 0||e.chat.info.group_info.gIntro===""?e.$t("群主很懒，还没有群介绍哦～"):e.chat.info.group_info.gIntro},null,8,Ms),i("div",bs,[(r(!0),h($,null,L(e.chat.info.group_info.tags,c=>(r(),h("div",{key:c.md},d(c.tag),1))),128))])],512)),[[b,Object.keys(e.chat.info.group_info).length>0]]):e.chat.show.type==="user"?(r(),h("div",Cs,[e.chat.info.user_info.qid?(r(),h("header",Is,[...t[12]||(t[12]=[i("span",null,"QID",-1)])])):f("",!0),e.chat.info.user_info.qid?(r(),h("span",Ss,d(e.chat.info.user_info.qid),1)):f("",!0),i("header",null,[i("span",null,d(e.$t("等级")),1)]),i("span",null,d(e.qqLevelToEmoji(e.chat.info.user_info.qqLevel)),1),e.chat.info.user_info.regTime?(r(),h("header",Ls,[i("span",null,d(e.$t("注册时间")),1)])):f("",!0),e.chat.info.user_info.regTime?(r(),h("span",Ds,d(Intl.DateTimeFormat(e.trueLang,{year:"numeric"}).format(new Date(e.chat.info.user_info.regTime*1e3))),1)):f("",!0),i("header",null,[i("span",null,d(e.$t("签名")),1)]),i("span",null,d(e.chat.info.user_info.longNick?e.chat.info.user_info.longNick:e.$t("这个人很懒什么都没有写～")),1),i("header",null,[i("span",null,d(e.$t("其他信息")),1)]),i("div",Bs,[e.chat.info.user_info.birthday_year?(r(),h("span",Ts,[E(d(e.$t("生日"))+": ",1),i("span",null,d(Intl.DateTimeFormat(e.trueLang,{year:"numeric",month:"short",day:"numeric"}).format(new Date(`${e.chat.info.user_info.birthday_year}-${e.chat.info.user_info.birthday_month}-${e.chat.info.user_info.birthday_day}`))),1)])):f("",!0),e.chat.info.user_info.country?(r(),h("span",Fs,[E(d(e.$t("地区"))+": ",1),i("span",null,d(`${e.chat.info.user_info.country}-${e.chat.info.user_info.province}-${e.chat.info.user_info.city}`),1)])):f("",!0)])])):f("",!0)],2),e.chat.show.type==="group"?(r(),M(v,{key:0,class:"chat-info-tab"},{default:j(()=>[i("div",{name:e.$t("成员")},[i("div",Es,[i("div",Ns,[i("input",{placeholder:e.$t("搜索 ……"),onInput:t[1]||(t[1]=(...c)=>e.searchList&&e.searchList(...c))},null,40,Os)]),(r(!0),h($,null,L(e.number_cache.length>0?e.number_cache:e.chat.info.group_members,c=>(r(),h("div",{key:"chatinfomlist-"+c.user_id,class:"edit"},[i("img",{alt:"nk",loading:"lazy",src:`https://q1.qlogo.cn/g?b=qq&s=0&nk=${c.user_id}`},null,8,Rs),i("div",null,[i("a",{onClick:T=>e.startChat(c)},d(c.card?c.card:c.nickname),9,Ps),c.role==="owner"?(r(),M(p,{key:0,icon:["fas","crown"]})):f("",!0),c.role==="admin"?(r(),M(p,{key:1,icon:["fas","star"]})):f("",!0)]),i("span",{onClick:T=>e.moreConfig(c)},d(c.user_id),9,Us),e.canEditMember(c.role)?(r(),M(p,{key:0,icon:["fas","wrench"],onClick:T=>e.moreConfig(c)},null,8,["onClick"])):(r(),M(p,{key:1,icon:["fas","copy"],onClick:T=>e.moreConfig(c.user_id)},null,8,["onClick"]))]))),128))])],8,js),i("div",{name:e.$t("公告")},[i("div",Hs,[(r(!0),h($,null,L(e.chat.info.group_notices??[],(c,T)=>(r(),M(n,{key:"bulletins-"+T,data:c,index:T},null,8,["data","index"]))),128))]),!e.chat.info.group_notices||e.chat.info.group_notices.length===0?(r(),h("div",As,d(e.$t("这里还没有公告哦~")),1)):f("",!0)],8,qs),i("div",{name:e.$t("文件")},[i("div",_s,[(r(!0),h($,null,L(e.chat.info.group_files,c=>(r(),h("div",{key:"file-"+(c.folder_id??c.file_id)},[m(y,{chat:e.chat,item:c},null,8,["chat","item"])]))),128))]),!e.chat.info.group_files||e.chat.info.group_files.length===0?(r(),h("div",Ws,d(e.$t("一点文件都没有耶——")),1)):f("",!0)],8,Gs),i("div",{name:e.$t("设置")},[i("div",Ks,[m(g,{type:"group",chat:e.chat,onUpdate_mumber_card:e.updateMumberCard},null,8,["chat","onUpdate_mumber_card"])])],8,zs)]),_:1})):f("",!0),i("div",{class:I("ss-card user-config"+(Object.keys(e.showUserConfig).length>0?" show":""))},[i("div",null,[i("img",{alt:"nk",src:`https://q1.qlogo.cn/g?b=qq&s=0&nk=${e.showUserConfig.user_id}`},null,8,Vs),i("div",null,[i("a",null,d(e.showUserConfig.card!=""?e.showUserConfig.card:e.showUserConfig.nickname),1),i("span",null,d(e.showUserConfig.user_id),1)]),m(p,{style:{"margin-right":"20px"},icon:["fas","copy"],onClick:t[2]||(t[2]=c=>e.copyText(e.showUserConfig.user_id))}),m(p,{icon:["fas","angle-down"],onClick:t[3]||(t[3]=c=>e.showUserConfig={})})]),i("div",null,[i("header",null,d(e.$t("成员信息")),1),i("div",Js,[m(p,{icon:["fas","clipboard-list"]}),i("div",null,[i("span",null,d(e.$t("成员昵称")),1),i("span",null,d(e.$t("啊吧啊吧……")),1)]),w(i("input",{"onUpdate:modelValue":t[4]||(t[4]=c=>e.showUserConfigRaw.card=c),style:{width:"50%"},class:"ss-input",type:"text",onChange:t[5]||(t[5]=c=>e.updateMumberCard(c,e.showUserConfig))},null,544),[[q,e.showUserConfigRaw.card]])]),e.chat.info.me_info.role==="owner"?(r(),h("div",Qs,[m(p,{icon:["fas","clipboard-list"]}),i("div",null,[i("span",null,d(e.$t("成员头衔")),1),i("span",null,d(e.$t("猪咪猪咪")),1)]),w(i("input",{"onUpdate:modelValue":t[6]||(t[6]=c=>e.showUserConfigRaw.title=c),style:{width:"50%"},class:"ss-input",type:"text",onChange:t[7]||(t[7]=c=>e.updateMumberTitle(c,e.showUserConfig))},null,544),[[q,e.showUserConfigRaw.title]])])):f("",!0),e.chat.info.me_info.role==="owner"&&e.showUserConfig.role!="owner"||e.chat.info.me_info.role==="admin"&&e.showUserConfig.role==="member"?(r(),h($,{key:1},[i("header",null,d(e.$t("操作")),1),i("div",Ys,[m(p,{icon:["fas","clipboard-list"]}),i("div",null,[i("span",null,d(e.$t("禁言成员")),1),i("span",null,d(e.$t("要让小猫咪不许说话几分钟呢？")),1)]),w(i("input",{"onUpdate:modelValue":t[8]||(t[8]=c=>e.mumberInfo.banMin=c),style:{width:"50%"},class:"ss-input",type:"text",onInput:t[9]||(t[9]=(...c)=>e.checkNumber&&e.checkNumber(...c)),onChange:t[10]||(t[10]=c=>e.banMumber(c,e.showUserConfig))},null,544),[[q,e.mumberInfo.banMin]])]),i("button",{class:"ss-button",onClick:t[11]||(t[11]=c=>e.removeUser(e.showUserConfig.nickname,e.chat.show.id,e.showUserConfig.user_id))},d(e.$t("移出群聊")),1)],64)):f("",!0)])],2)]),t[13]||(t[13]=i("div",{class:"card-info-pan-bg"},null,-1))])):f("",!0)}const Zs=P(fs,[["render",Xs],["__scopeId","data-v-0a146994"]]),xs=O({name:"NoticeBody",props:["data","id"],data(){return{trueLang:G(),getTimeConfig:ne,info:ae(this.data)}},async mounted(){var t;let e=null;if(e=await B.call(void 0,"win:getWindowInfo",!0),this.info.notice_type&&this.info.notice_type.indexOf("recall")>=0)if(l.chatInfo.show.type==="group"){const a=this.info.operator_id;if(l.chatInfo.info.group_members!==void 0){const s=l.chatInfo.info.group_members.filter(o=>o.user_id===Number(a));s.length===1?this.info.name=s[0].card===""||s[0].card==null?s[0].nickname:s[0].card:this.info.name=a}else this.info.name=a}else this.info.name=l.chatInfo.show.name;if(this.info.sub_type==="poke"&&this.info.pokeMe&&this.info==l.messageList[l.messageList.length-1]){let a=document.getElementById("app");B.isDesktop()&&(a=(t=document.getElementById("notice-"+this.id))==null?void 0:t.getElementsByClassName("space")[0]),be(a,e)}},methods:{isMe(e){return l.loginInfo.uin===e},getName(e){const t=l.chatInfo.info.group_members.filter(a=>a.user_id===e);return t.length===1?t[0].card===""||t[0].card==null?t[0].nickname:t[0].card:e},fTime(e){const t=Math.floor(e/86400),a=Math.floor(e%86400/3600),s=Math.floor(e%3600/60),o=e%60;let u="";return t>0&&(u+=`${t} ${this.$t("天")} `),a>0&&(u+=`${a} ${this.$t("小时")} `),s>0&&(u+=`${s} ${this.$t("分钟")} `),o>0&&(u+=`${o} ${this.$t("秒")} `),u}}}),et=["id"],st={key:0,class:"note-recall note-base"},tt={key:1,class:"note-ban note-base"},it={key:1},nt={key:2,class:"note-recall note-base"},ot=["innerHTML"],at={key:4,class:"note-time note-base"};function lt(e,t,a,s,o,u){return r(),h("div",{id:"notice-"+e.id,class:"note"},[e.data.notice_type&&e.data.notice_type.indexOf("recall")>=0?(r(),h("div",st,[i("a",null,d(e.info.name),1),i("span",null,d(e.$t("撤回了一条消息")),1),t[0]||(t[0]=i("div",null,null,-1))])):e.data.notice_type=="group_ban"?(r(),h("div",tt,[e.data.sub_type==="ban"?(r(),h($,{key:0},[e.isMe(e.data.user_id)?(r(),h($,{key:0},[i("span",null,d(e.$t("成员类型_admin")),1),i("a",null," "+d(e.getName(e.data.operator_id))+" ",1),i("span",null,d(e.$t("禁言了你")),1),i("span",null," "+d(e.fTime(e.data.duration)),1)],64)):(r(),h($,{key:1},[i("span",null,d(e.$t("管理员禁言了")),1),i("a",null," "+d(e.getName(e.data.user_id))+" ",1),i("span",null,d(e.fTime(e.data.duration)),1)],64))],64)):(r(),h("span",it,d(e.$t("管理员解除了 {name} 的禁言",{name:e.isMe(e.data.user_id)?e.$t("你"):e.getName(e.data.user_id)})),1))])):e.data.sub_type==="delete"?(r(),h("div",nt,[i("span",null,d(e.$t("这条消息迷失在虚空里了")),1),t[1]||(t[1]=i("div",null,null,-1))])):e.data.sub_type==="poke"?(r(),h("div",{key:3,class:"note-notify note-base",innerHTML:e.data.str+"<div class='space'</div>"},null,8,ot)):e.data.sub_type==="time"&&e.data.time!=null?(r(),h("div",at,[i("a",null,d(Intl.DateTimeFormat(e.trueLang,e.getTimeConfig(new Date(e.data.time*1e3))).format(new Date(e.data.time*1e3))),1)])):f("",!0)],8,et)}const A=P(xs,[["render",lt]]),x=new R,rt=O({name:"FacePan",components:{BcTab:ge,EmojiFace:ie},props:["display"],emits:["addSpecialMsg","sendMsg"],data(){return{Option:K,runtimeData:l,baseFaceMax:348,stickerPage:1,Emoji:z,backend:B,localEmojis:[]}},mounted(){l.stickerCache===void 0&&l.jsonMap.roaming_stamp&&this.reloadRoamingStamp(),B.isDesktop()&&l.sysConfig.local_emoji_folder&&this.reloadLocalEmojis()},methods:{reloadRoamingStamp(){l.stickerCache=void 0,l.jsonMap.roaming_stamp.pagerType=="full"?C.send(l.jsonMap.roaming_stamp.name,{count:48},"getRoamingStamp_48"):C.send(l.jsonMap.roaming_stamp.name,{},"getRoamingStamp")},addSpecialMsg(e,t){this.$emit("addSpecialMsg",{addText:t,msgObj:e})},addBaseFace(e){e<5e3?this.addSpecialMsg({type:"face",id:e},!0):this.addSpecialMsg({type:"text",text:z.get(e).value},!0)},addImgFace(e){this.addSpecialMsg({type:"image",file:e,subType:1},!0),l.sysConfig.send_face==!0&&this.$emit("sendMsg")},stickersScroll(e){const t=e.target;if(t.scrollHeight-t.scrollTop<t.clientHeight+.5&&l.stickerCache&&l.jsonMap.roaming_stamp.pagerType=="full"&&l.stickerCache[l.stickerCache.length-1]!="end"){const a=48+48*this.stickerPage;C.send(l.jsonMap.roaming_stamp.name,{count:a},"getRoamingStamp_"+a),this.stickerPage++}},async selectLocalEmojiFolder(){try{const{$t:e}=this,t=await B.call(void 0,"sys:selectFolder",!0);t&&(K.save("local_emoji_folder",t),x.add(S.INFO,e("已设置本地表情文件夹")),this.reloadLocalEmojis())}catch{const{$t:t}=this;x.add(S.ERR,t("选择文件夹失败"))}},async reloadLocalEmojis(){try{const e=l.sysConfig.local_emoji_folder;if(!e){this.localEmojis=[];return}const t=await B.call(void 0,"sys:getLocalEmojis",!0,e);if(t&&Array.isArray(t))if(B.type==="tauri"){const{convertFileSrc:a}=await ue(async()=>{const{convertFileSrc:s}=await import("./@tauri-apps-CZq0uPQG.js").then(o=>o.c);return{convertFileSrc:s}},[]);this.localEmojis=t.map(s=>({name:s.name,path:s.path,url:a(s.path)}))}else this.localEmojis=t.map(a=>({name:a.name,path:a.path,url:a.url}));else this.localEmojis=[]}catch{this.localEmojis=[]}},async addLocalEmoji(e){try{const t=await B.call(void 0,"sys:readFileAsBase64",!0,e.path);this.addSpecialMsg({type:"image",file:"base64://"+t,subType:1},!0),l.sysConfig.send_face==!0&&this.$emit("sendMsg")}catch{const{$t:a}=this;x.add(S.ERR,a("添加本地表情失败"))}}}}),dt={class:"ss-card face-pan"},ut={icon:"fa-solid fa-face-laugh-squint"},ht={class:"system-face-bar"},mt={class:"title"},pt={class:"base-face"},gt={class:"title"},ft={class:"base-face"},ct={class:"title"},yt={class:"base-face"},wt={icon:"fa-solid fa-heart"},kt={class:"title"},$t=["src","onClick"],vt={class:"ss-card"},Mt={key:0,icon:"fa-solid fa-folder-open"},bt={class:"title"},Ct={class:"face-stickers"},It=["src","title","onClick"],St={class:"ss-card"},Lt={class:"ss-card"};function Dt(e,t,a,s,o,u){const p=D("EmojiFace"),n=D("font-awesome-icon"),y=D("BcTab");return r(),h("div",dt,[m(y,null,{default:j(()=>[i("div",ut,[i("div",ht,[i("div",mt,[i("span",null,d(e.$t("超级表情")),1)]),i("div",pt,[(r(!0),h($,null,L(e.Emoji.superList,g=>(r(),h("div",{key:"base-face-wrapper-"+g},[(r(),M(p,{key:"base-face-"+g,emoji:e.Emoji.get(g),onClick:v=>e.addBaseFace(g)},null,8,["emoji","onClick"]))]))),128))]),i("div",gt,[i("span",null,d(e.$t("小黄脸表情")),1)]),i("div",ft,[(r(!0),h($,null,L(e.Emoji.normalList,g=>(r(),h("div",{key:"base-face-wrapper-"+g},[(r(),M(p,{key:"base-face-"+g,emoji:e.Emoji.get(g),onClick:v=>e.addBaseFace(g)},null,8,["emoji","onClick"]))]))),128))]),i("div",ct,[i("span",null,d(e.$t("emoji 表情")),1)]),i("div",yt,[(r(!0),h($,null,L(e.Emoji.emojiList,g=>(r(),h("div",{key:"base-face-wrapper-"+g},[(r(),M(p,{key:"base-face-"+g,emoji:e.Emoji.get(g),onClick:v=>e.addBaseFace(g)},null,8,["emoji","onClick"]))]))),128))])])]),i("div",wt,[i("div",kt,[i("span",null,d(e.$t("收藏的表情")),1),m(n,{icon:["fas","fa-rotate-right"],onClick:e.reloadRoamingStamp},null,8,["onClick"])]),i("div",{class:"face-stickers",onScroll:t[0]||(t[0]=(...g)=>e.stickersScroll&&e.stickersScroll(...g))},[(r(!0),h($,null,L(e.runtimeData.stickerCache,(g,v)=>w((r(),h("img",{key:"stickers-"+v,loading:"lazy",src:g,onClick:c=>e.addImgFace(g)},null,8,$t)),[[b,g!="end"]])),128)),w(i("div",vt,[m(n,{icon:["fas","face-dizzy"]}),i("span",null,d(e.$t("一无所有")),1)],512),[[b,e.runtimeData.stickerCache&&e.runtimeData.stickerCache.length<=0]])],32)]),e.backend.isDesktop()?(r(),h("div",Mt,[i("div",bt,[i("span",null,d(e.$t("本地表情")),1),m(n,{icon:["fas","fa-folder-plus"],title:e.$t("选择文件夹"),onClick:e.selectLocalEmojiFolder},null,8,["title","onClick"]),e.runtimeData.sysConfig.local_emoji_folder?(r(),M(n,{key:0,icon:["fas","fa-rotate-right"],title:e.$t("重新加载"),onClick:e.reloadLocalEmojis},null,8,["title","onClick"])):f("",!0)]),i("div",Ct,[(r(!0),h($,null,L(e.localEmojis,(g,v)=>(r(),h("img",{key:"local-emoji-"+v,loading:"lazy",src:g.url,title:g.name,onClick:c=>e.addLocalEmoji(g)},null,8,It))),128)),w(i("div",St,[m(n,{icon:["fas","folder-open"]}),i("span",null,d(e.$t("选择文件夹")),1)],512),[[b,!e.runtimeData.sysConfig.local_emoji_folder]]),w(i("div",Lt,[m(n,{icon:["fas","face-dizzy"]}),i("span",null,d(e.$t("暂无图片")),1)],512),[[b,e.runtimeData.sysConfig.local_emoji_folder&&e.localEmojis.length<=0]])])])):f("",!0)]),_:1})])}const Bt=P(rt,[["render",Dt]]),Tt=O({name:"MergePan",components:{NoticeBody:A,MsgBody:V},data(){const e=l.mergeMsgStack,t=ae();return{uuid:le,runtimeData:l,stack:e,nowData:t,isShowTime:X,isDeleteMsg:oe}},mounted(){this.$watch(()=>l.mergeMsgStack.length,()=>{this.stack.length===0?l.mergeMessageImgList=void 0:this.nowData=this.stack.at(-1)}),this.$watch(()=>{var e;return(e=this.nowData)==null?void 0:e.imageList},()=>{var e;l.mergeMsgStack.length===0||((e=this.nowData)==null?void 0:e.imageList)===void 0||(l.mergeMessageImgList=this.nowData.imageList)})},methods:{exitMergeMsg(){this.stack.length--},closeMergeMsg(){this.stack.length=0},isMergeOpen(){return this.stack.length>0}}}),Ft={class:"ss-card"},jt={key:0};function Et(e,t,a,s,o,u){const p=D("font-awesome-icon"),n=D("NoticeBody"),y=D("MsgBody");return r(),h("div",{class:I("merge-pan"+(e.runtimeData.mergeMsgStack.length>0?" show":""))},[i("div",{onClick:t[0]||(t[0]=(...g)=>e.closeMergeMsg&&e.closeMergeMsg(...g))}),i("div",Ft,[i("div",null,[m(p,{style:{"margin-top":"5px"},icon:["fas","message"]}),i("span",null,d(e.$t("合并消息")),1),e.stack.length<=1?(r(),M(p,{key:0,icon:["fas","xmark"],onClick:e.exitMergeMsg},null,8,["onClick"])):(r(),M(p,{key:1,icon:["fas","angles-left"],onClick:e.exitMergeMsg},null,8,["onClick"]))]),e.nowData===void 0?(r(),h("div",jt)):(r(),M(se,{key:1,name:e.runtimeData.sysConfig.opt_fast_animation?"":"msglist",tag:"div"},{default:j(()=>[(r(!0),h($,null,L(e.nowData.messageList,(g,v)=>(r(),h($,{key:"merge-"+e.nowData.forwardMsg.message[0].id+"-"+v},[e.isShowTime(e.nowData.messageList[v-1]?e.nowData.messageList[v-1].time:void 0,g.time,v==0)?(r(),M(n,{id:e.uuid(),key:"notice-time-"+v,data:{sub_type:"time",time:g.time}},null,8,["id","data"])):e.isDeleteMsg(g)?(r(),M(n,{key:"delete-"+g.message_id,data:{sub_type:"delete"}})):f("",!0),m(y,{data:g,type:"merge"},null,8,["data"])],64))),128))]),_:1},8,["name"]))])],2)}const Nt=P(Tt,[["render",Et],["__scopeId","data-v-f1943c68"]]),Ot=["src"],Rt={name:"id"},Pt=["src"],Ut={name:"id"},qt={key:0,class:"robot"},Ht={key:1,class:"owner"},At={key:2,class:"admin"},Gt={class:"member"},_t={key:0},Wt=O({__name:"UserInfoPan",props:{data:{}},setup(e){const t=ae(void 0),a=Y({"--x":"0px","--y":"0px","--width":"0px"}),s=Pe(()=>{var o,u,p;return{"user-title":!0,robot:(o=e.data.user)==null?void 0:o.is_robot,owner:((u=e.data.user)==null?void 0:u.role)=="owner",admin:((p=e.data.user)==null?void 0:p.role)=="admin"}});return Ue(()=>{if(a["--x"]=e.data.x+"px",a["--y"]=e.data.y+"px",t.value&&(a["--width"]=t.value.offsetWidth+"px"),!t.value)return;const o=t.value.clientHeight,u=document.body.clientHeight;e.data.y+o>u-20&&(a["--y"]=u-o-10+"px");const p=t.value.clientWidth,n=document.body.clientWidth;e.data.x+p>n-20&&(a["--x"]=n-p-10+"px")}),(o,u)=>{const p=D("font-awesome-icon");return r(),M(pe,{to:"body"},[m(H,{name:"member-info"},{default:j(()=>{var n,y,g,v,c,T,F;return[e.data.user?(r(),h("div",{key:0,class:"member-info",style:te(a)},[typeof e.data.user=="number"?(r(),h("div",{key:0,ref_key:"body",ref:t,class:"ss-card leave"},[i("div",null,[i("img",{src:"https://q1.qlogo.cn/g?b=qq&s=0&nk="+e.data.user},null,8,Ot),i("div",null,[i("span",Rt,d(e.data.user),1),i("div",null,[i("a",null,d(o.$t("已退群( {userId} )",{userId:e.data.user})),1)])])])],512)):(r(),h("div",{key:1,ref_key:"body",ref:t,class:"ss-card"},[i("div",null,[i("img",{src:"https://q1.qlogo.cn/g?b=qq&s=0&nk="+e.data.user.user_id},null,8,Pt),i("div",null,[i("span",Ut,d(e.data.user.user_id),1),i("div",null,[i("a",null,d(e.data.user.card?e.data.user.card:e.data.user.nickname),1),i("span",{class:I(s.value)},[(n=e.data.user)!=null&&n.is_robot?(r(),h($,{key:0},[E(d(o.$t("机器人")),1)],64)):f("",!0),((y=e.data.user)==null?void 0:y.role)=="owner"?(r(),h($,{key:1},[E(d(o.$t("群主")),1)],64)):f("",!0),((g=e.data.user)==null?void 0:g.role)=="admin"?(r(),h($,{key:2},[E(d(o.$t("管理员")),1)],64)):f("",!0),(v=e.data.user)!=null&&v.level?(r(),h($,{key:3},[E(d("Lv."+e.data.user.level),1)],64)):f("",!0)],2),(c=e.data.user)!=null&&c.is_robot?(r(),h("span",qt,d(o.$t("机器人")),1)):f("",!0),((T=e.data.user)==null?void 0:T.role)=="owner"?(r(),h("span",Ht,d(o.$t("群主")),1)):((F=e.data.user)==null?void 0:F.role)=="admin"?(r(),h("span",At,d(o.$t("管理员")),1)):f("",!0)])])]),i("div",Gt,[i("div",null,[e.data.user.banTime?(r(),h($,{key:0},[m(p,{style:{color:"var(--color-red)"},icon:["fas","fa-volume-mute"]}),E(" "+d(o.$t("禁言中")),1)],64)):f("",!0)]),e.data.user.join_time?(r(),h("span",_t,d(o.$t("{time} 加入群聊",{time:Intl.DateTimeFormat(k(G)(),{year:"numeric",month:"short",day:"numeric"}).format(new Date(e.data.user.join_time*1e3))})),1)):f("",!0)])],512))],4)):f("",!0)]}),_:1})])}}}),zt=P(Wt,[["__scopeId","data-v-a4f2f54c"]]),Kt={class:"info"},Vt=["src"],Jt={class:"info"},Qt={key:0},Yt={key:1},Xt={class:"more"},Zt={key:0,class:"note note-nomsg"},xt={key:1,class:"note note-nomsg"},ei={key:1,id:"msgPan",class:"chat",style:{"scroll-behavior":"smooth"}},si={class:"ss-card"},ti={key:0},ii={id:"send-more",class:"more"},ni={class:"ss-card jin-pan"},oi=["src"],ai={class:"context"},li={key:0},ri=["src"],di={class:"jin-pan-load"},ui={class:"imgs"},hi={class:"img-btns"},mi=["onClick"],pi=["onClick"],gi={class:"img"},fi=["src","alt"],ci=["onClick"],yi=["src"],wi={key:0,class:"emp"},ki=["title"],$i=["title"],vi=["title"],Mi=["title"],bi=["title"],Ci=["title"],Ii=["disabled","placeholder"],Si=["disabled"],Li={key:0,class:"forward-pan"},Di={class:"ss-card card"},Bi=["placeholder"],Ti=["onClick"],Fi=["title","src"],ji=O({name:"ViewChat",inject:["viewer"],props:["chat","list","imgView"],data(){const e={beforeHook:t=>{const a=this.getTargetWin();if(!a)return;a.style.transition="all 0s";const s=document.getElementById("chat-pan");if(!s)return;const o=s.getElementsByClassName("chat")[0];o&&(o.style.overflowY="hidden")},moveHook:(t,a)=>{const s=this.getTargetWin();s&&(s.style.transform="translateX("+a+"px)")},endHook:t=>{const a=document.getElementById("chat-pan"),s=a==null?void 0:a.getElementsByClassName("chat")[0];s&&(s.style.overflowY="scroll");const o=this.getTargetWin();o&&(o.style.transition="transform 0.3s",o.style.transform="")},rightLimit:{value:100,type:"%"},speedCondition:{minMove:{value:.5*l.inch,type:"px"},minSpeed:5*l.inch},moveCondition:{minMove:{value:33,type:"%"}}};return{backend:B,uuid:le,getShowName:he,fun:{getMsgRawTxt:_},Option:K,Connector:C,runtimeData:l,getTimeConfig:ne,forwardList:l.userList,trueLang:G(),multipleSelectList:[],tags:{sendTag:"REFUSE",nowGetHistroy:!1,showBottomButton:!0,showMoreDetail:!1,showMsgMenu:!1,showForwardPan:!1,openChatInfo:!1,isReply:!1,isJinLoading:!1,onAtFind:!1,menuDisplay:{menuSelectedMsgId:null,jumpToMsg:!1,add:!0,relpy:!0,forward:!0,select:!0,copy:!0,copySelect:!1,copyImg:!1,downloadImg:!1,revoke:!1,at:!0,poke:!1,remove:!1,respond:!1,showRespond:!0,config:!1},search:{userId:-1,list:Y(this.list)},msgTouch:{x:-1,y:-1,msgOnTouchDown:!1,onMove:"no"},checkNewLineFlag:!1},details:[{open:!1},{open:!1},{open:!1},{open:!1}],msgMenus:[],NewMsgNum:0,msg:"",oldMsg:"",imgCache:new Map,sendCache:[],selectedMsg:null,selectCache:"",replyMsgInfo:null,atFindList:null,atSelectedIndex:0,atScrollTimer:null,atScrollInterval:null,isShowTime:X,isDeleteMsg:oe,isDev:!1,chatMoveOptions:e,chatImg:void 0}},watch:{chat(){const e=this.$options.data(this);this.tags=e.tags,this.msgMenus=e.msgMenus,this.sendCache=[],this.imgCache.clear(),this.multipleSelectList=[],this.initMenuDisplay()},msg(e,t){this.oldMsg=t}},async mounted(){this.updateList(this.list.length,0),this.$watch(()=>this.list.length,this.updateList),this.$watch(()=>this.chat.info.jin_info.list.length,()=>{this.tags.isJinLoading=!1}),B.type=="capacitor"&&B.platform==="android"&&B.addListener("App","backButton",()=>{this.exitWin()}),this.$watch(()=>l.watch.backTimes,()=>{this.exitWin()})},methods:{jumpSearchMsg(){this.closeSearch(),setTimeout(()=>{var e;this.selectedMsg&&(this.scrollToMsg("chat-"+((e=this.selectedMsg)==null?void 0:e.message_id)),this.closeMsgMenu())},100)},chatScroll(e){const t=e.target,a=document.getElementById("send-more");t.scrollTop===0&&this.list.length>0&&this.loadMoreHistory(),t.scrollTop+t.clientHeight+10>=t.scrollHeight&&(this.NewMsgNum=0,this.tags.showBottomButton=!1,a&&(a.style.transition="background .3s",a.classList.add("btn"))),t.scrollTop<t.scrollHeight-t.clientHeight*2&&this.tags.showBottomButton!==!0&&(this.tags.showBottomButton=!0),t.scrollTop<t.scrollHeight-t.clientHeight-10&&a&&(a.style.transition="background 1s",a.classList.remove("btn"))},loadMoreHistory(){var e;if(!this.tags.nowGetHistroy&&l.tags.canLoadHistory!==!1){const t=this.list[0].message_id;this.tags.nowGetHistroy=!0,l.tags.loadHistoryFail=!1;const a=((e=l.jsonMap.message_list)==null?void 0:e.pagerType)=="full",s=l.chatInfo.show.type,o=l.chatInfo.show.id;let u;l.jsonMap.message_list&&s!="group"?u=l.jsonMap.message_list.private_name:u=l.jsonMap.message_list.name,C.send(u??"get_chat_history",{group_id:s=="group"?o:void 0,user_id:s!="group"?o:void 0,message_id:t,count:a?l.messageList.length+20:20},"getChatHistory")}},scrollTo(e,t=!0){const a=document.getElementById("msgPan");a!==null&&e&&(t===!1?a.style.scrollBehavior="unset":a.style.scrollBehavior="smooth",a.scrollTop=e,a.style.scrollBehavior="smooth")},scrollBottom(e=!1){const t=document.getElementById("msgPan");t!==null&&this.scrollTo(t.scrollHeight,e)},scrollToMsg(e){ee(e,!0)||new R().add(S.INFO,this.$t("无法定位上下文"))},imgLoadedScroll(e){const t=document.getElementById("msgPan");t&&(this.list.length<=20&&!this.tags.showBottomButton?this.scrollBottom():this.scrollTo(t.scrollTop+e,!1))},mainKey(e){if(this.tags.onAtFind&&this.atFindList&&this.atFindList.length>0){if(e.keyCode===38||e.keyCode===40){e.preventDefault();const a=e.keyCode===38?-1:1;if(this.moveAtSelection(a),this.atScrollTimer!==null)return;this.atScrollTimer=setTimeout(()=>{this.atScrollInterval=setInterval(()=>{this.moveAtSelection(a)},50)},300);return}if(e.keyCode===13){e.preventDefault();const a=this.atFindList[this.atSelectedIndex];a&&this.choiceAt(a.user_id);return}if(e.keyCode===27){e.preventDefault();const a=this.msg.lastIndexOf("@");a>=0&&(this.msg=this.msg.substring(0,a)),this.tags.onAtFind=!1,this.atFindList=null,this.atSelectedIndex=0;return}}if(this.tags.onAtFind||e.key!=="Enter")return;let t=!1;switch(l.sysConfig.send_key){case"none":if(e.shiftKey||e.ctrlKey||e.altKey||e.metaKey)break;t=!0;break;case"shift":if(!e.shiftKey)break;t=!0;break;case"ctrl":if(!e.ctrlKey)break;t=!0;break;case"alt":if(!e.altKey)break;t=!0;break;case"meta":if(!e.metaKey)break;t=!0;break}t&&this.tags.sendTag!="PASS"&&(this.tags.sendTag="READY"),this.tags.sendTag=="READY"&&this.msg!==""?this.sendMsg():e.key==="Enter"&&(e.ctrlKey||e.metaKey||e.altKey)&&(this.msg+=`
`),this.tags.sendTag="REFUSE"},handleCompositionStart(){this.tags.sendTag="REFUSE"},handleCompositionEnd(){this.tags.sendTag="PASS",setTimeout(()=>{this.tags.sendTag="READY"},50)},mainKeyUp(e){const t=new U;if((e.keyCode===38||e.keyCode===40)&&(this.atScrollTimer!==null&&(clearTimeout(this.atScrollTimer),this.atScrollTimer=null),this.atScrollInterval!==null&&(clearInterval(this.atScrollInterval),this.atScrollInterval=null)),this.tags.checkNewLineFlag&&(this.tags.checkNewLineFlag=!1,this.msg==`
`&&(this.msg="")),!(this.tags.onAtFind&&this.atFindList&&this.atFindList.length>0&&(e.keyCode===38||e.keyCode===40||e.keyCode===13||e.keyCode===27))&&e.keyCode!=13){const a=this.msg.substring(this.msg.length-1);if(!this.tags.onAtFind&&a=="@"&&l.chatInfo.info.group_members.length>0&&l.chatInfo.show.type=="group"&&(t.add(J.UI,"开始匹配群成员列表 ……"),this.tags.onAtFind=!0,this.atSelectedIndex=0),this.tags.onAtFind)if(this.msg.lastIndexOf("@")<0)t.add(J.UI,"匹配群成员列表被打断 ……"),this.tags.onAtFind=!1,this.atFindList=null,this.atSelectedIndex=0;else{const s=this.msg.substring(this.msg.lastIndexOf("@")+1).toLowerCase();this.atFindList=l.chatInfo.info.group_members.filter(o=>o.card!=""&&o.card!=null&&o.card.toLowerCase().indexOf(s)>=0||o.nickname.toLowerCase().indexOf(s)>=0||s==o.user_id.toString()),this.atFindList.length==0&&(this.atFindList=l.chatInfo.info.group_members),this.atSelectedIndex=0}}},mainSubmit(e){e.preventDefault(),this.msg!=""&&this.sendMsg()},choiceAt(e){e!=null&&(this.msg=this.msg.substring(0,this.msg.lastIndexOf("@")),this.addSpecialMsg({msgObj:{type:"at",qq:e},addText:!0})),this.toMainInput(),this.tags.onAtFind=!1,this.atFindList=null,this.atSelectedIndex=0},scrollAtListToSelected(){this.$nextTick(()=>{const e=document.querySelector(".at-tag.show"),t=document.querySelector(".at-tag.show > div.selected");if(e&&t){const a=e.getBoundingClientRect(),s=t.getBoundingClientRect();s.top<a.top?t.scrollIntoView({block:"nearest",behavior:"smooth"}):s.bottom>a.bottom&&t.scrollIntoView({block:"nearest",behavior:"smooth"})}})},moveAtSelection(e){!this.atFindList||this.atFindList.length===0||(e===-1?this.atSelectedIndex=this.atSelectedIndex>0?this.atSelectedIndex-1:this.atFindList.length-1:this.atSelectedIndex=this.atSelectedIndex<this.atFindList.length-1?this.atSelectedIndex+1:0,this.scrollAtListToSelected())},selectSQIn(){const e=document.getElementById("main-input");if(e!==null&&e.selectionStart===e.selectionEnd){let t=-1;typeof e.selectionStart=="number"&&(t=e.selectionStart);const a=de.getSQList(this.msg);a!=null&&a.forEach(s=>{const o=this.msg.indexOf(s),u=o+s.length;o!==-1&&t>o&&t<u&&this.$nextTick(()=>{e.selectionStart=o,e.selectionEnd=u})})}},showMsgMeun(e,t){var u;if(this.selectedMsg=t,this.tags.menuDisplay.menuSelectedMsgId=t.message_id,K.get("log_level")==="debug"&&new U().debug("右击消息："+t),this.multipleSelectList.length>0)return;const a=document.getElementById("msgMenu"),s=e.target;let o="member";if(l.chatInfo.show.type=="group"&&l.chatInfo.info.group_members&&l.chatInfo.info.group_members.forEach(p=>{p.user_id==t.sender.user_id&&(o=p.role)}),a!==null&&t!==null){if(Ne("close_respond")==!0&&(this.tags.menuDisplay.showRespond=!1),s.nodeName=="IMG"&&s.name=="avatar")Object.keys(this.tags.menuDisplay).forEach(v=>{this.tags.menuDisplay[v]=!1}),this.tags.menuDisplay.showRespond=!1,this.tags.menuDisplay.at=!0,this.tags.menuDisplay.poke=!0,this.tags.menuDisplay.remove=!0,(l.chatInfo.show.type!="group"||t.sender.user_id===l.loginInfo.uin||l.chatInfo.info.me_info.role==="member"||o=="owner"||o=="admin"&&l.chatInfo.info.me_info.role!="owner")&&(this.tags.menuDisplay.remove=!1),t.sender.user_id===l.loginInfo.uin&&(this.tags.menuDisplay.at=!1),l.chatInfo.show.type=="group"&&l.chatInfo.info.me_info.role!="member"&&(this.tags.menuDisplay.config=!0);else{(t.sender.user_id===l.loginInfo.uin||l.chatInfo.info.me_info.role==="admin"||l.chatInfo.info.me_info.role==="owner")&&(this.tags.menuDisplay.revoke=!0),t.revoke===!0&&(this.tags.menuDisplay.relpy=!1,this.tags.menuDisplay.forward=!1,this.tags.menuDisplay.revoke=!1,this.tags.menuDisplay.select=!1),this.details[3].open&&(Object.keys(this.tags.menuDisplay).forEach(Z=>{this.tags.menuDisplay[Z]=!1}),this.tags.menuDisplay.jumpToMsg=!0);const v=document.getSelection(),c=(u=v==null?void 0:v.anchorNode)==null?void 0:u.parentElement;let T=null,F=c;if(F)for(;F.className!="chat";){if(F.className.startsWith("message")&&F.className.indexOf("-")<0){T=F;break}if(F=F.parentElement,!F)break}c&&c.className.indexOf("msg-text")>-1&&v.focusNode==v.anchorNode&&T&&T.id==t.message_id&&(this.selectCache=v.toString(),this.selectCache.length>0&&(this.tags.menuDisplay.copySelect=!0));const fe=["xml","json"];t.message.forEach(Z=>{fe.indexOf(Z.type)>0&&(this.tags.menuDisplay.forward=!1,this.tags.menuDisplay.add=!1)}),s.nodeName=="IMG"&&s.src.length>0&&(this.tags.menuDisplay.downloadImg=s.src,B.isDesktop()&&(this.tags.menuDisplay.copyImg=!0))}const p=e.x,n=e.y;a.style.marginLeft=p+"px",a.style.marginTop=n+"px";let y=a.clientWidth;this.tags.menuDisplay.showRespond&&(y=a.children[0].clientWidth);const g=window.innerWidth;p+y>g+27&&(a.style.marginLeft=g+7-y+"px"),this.tags.showMsgMenu=!0,setTimeout(()=>{const v=a.clientHeight,c=document.body.clientHeight;n+v>c-20&&(a.classList.add("topOut"),a.style.marginTop=c-v-10+"px")},100)}},initMenuDisplay(){this.tags.menuDisplay={menuSelectedMsgId:null,jumpToMsg:!1,add:!0,relpy:!0,forward:!0,select:!0,copy:!0,copySelect:!1,downloadImg:!1,copyImg:!1,revoke:!1,at:!1,poke:!1,remove:!1,respond:!1,showRespond:!0,config:!1}},menuReplyMsg(e=!0){const t=this.selectedMsg;t&&(this.replyMsg(t),e&&this.closeMsgMenu())},replyMsg(e){const t=e.message_id;this.selectedMsg=e,this.addSpecialMsg({msgObj:{type:"reply",id:String(t)},addText:!1,addTop:!0}),this.tags.isReply=!0,this.toMainInput()},cancelReply(){this.sendCache=this.sendCache.filter(e=>e.type!=="reply"),this.tags.isReply=!1},consoleLogMsg(){this.selectedMsg&&(console.log(this.selectedMsg),this.closeMsgMenu())},cancelForward(){this.forwardList=l.userList,this.tags.showForwardPan=!1,this.closeMsgMenu()},searchForward(e){const t=e.target.value;this.forwardList=l.userList.filter(a=>{const s=(a.user_id?a.nickname+a.remark:a.group_name).toLowerCase(),o=a.user_id?a.user_id:a.group_id;return s.indexOf(t.toLowerCase())!==-1||o.toString()===t})},showForWard(){this.tags.showForwardPan=!0,Object.assign(l.onMsgList).reverse().forEach(t=>{const a=this.forwardList.indexOf(t);a>-1&&(this.forwardList.splice(a,1),this.forwardList.unshift(t))}),this.closeMsgMenu()},forwardSelf(){if(this.selectedMsg){const e=JSON.parse(JSON.stringify(this.selectedMsg));W(this.chat.show.id,this.chat.show.type,e.message,!0)}this.closeMsgMenu()},intoMultipleSelect(){this.selectedMsg&&this.multipleSelectList.push(this.selectedMsg.message_id),this.closeMsgMenu()},forwardMsg(e){const t=this.selectedMsg,a=e.group_id?e.group_id:e.user_id;if(this.multipleSelectList.length>0&&t){const s=l.messageList.filter(n=>this.multipleSelectList.indexOf(n.message_id)>=0),o={app:"com.tencent.multimsg",meta:{detail:{source:this.$t("合并转发消息"),news:[...s.slice(0,3).map(n=>({text:(n.sender.card&&n.sender.card!=""?n.sender.card:n.sender.nickname)+": "+_(n)}))],summary:this.$t("查看 {count} 条转发消息",{count:this.multipleSelectList.length}),resid:""}}},u={message:[{type:"json",data:JSON.stringify(o),id:""}],sender:{user_id:l.loginInfo.uin,nickname:l.loginInfo.nickname}},p={title:this.$t("合并转发消息"),template:Q(V),templateValue:Q({data:u,type:"forward"}),button:[{text:this.$t("取消"),fun:()=>{l.popBoxList.shift()}},{text:this.$t("确定"),master:!0,fun:()=>{const n=s.map(y=>({type:"node",id:y.message_id,user_id:y.sender.user_id,nickname:y.sender.nickname,content:y.message}));W(this.chat.show.id,this.chat.show.type,n,!0),l.popBoxList.shift()}}]};l.popBoxList.push(p)}else if(this.selectedMsg&&t){const s={title:this.$t("转发消息"),template:Q(V),templateValue:Q({data:t,type:"forward"}),button:[{text:this.$t("取消"),fun:()=>{l.popBoxList.shift()}},{text:this.$t("确定"),master:!0,fun:()=>{W(this.chat.show.id,this.chat.show.type,t.message,!0),l.popBoxList.shift()}}]};l.popBoxList.push(s)}this.cancelForward(),l.baseOnMsgList.get(a)==null&&l.baseOnMsgList.set(a,e),this.$nextTick(()=>{const s=document.getElementById("user-"+a);s&&s.click()})},sendRespond(e){const t=this.selectedMsg;if(t!==null){const a=t.message_id;C.send(l.jsonMap.send_respond.name,{group_id:this.chat.show.id,message_id:a,emoji_id:String(e),code:String(e)},"SendRespondBack_"+a+"_"+e)}this.closeMsgMenu()},copyMsg(){const e=this.selectedMsg;if(e!==null){e.raw_message||(e.raw_message=_(e));const t=new R;N.config.globalProperties.$copyText(e.raw_message).then(()=>{t.add(S.INFO,this.$t("复制成功"),!0)},()=>{t.add(S.ERR,this.$t("复制失败"),!0)})}this.closeMsgMenu()},copySelectMsg(){if(this.selectCache!=""){const e=new R;N.config.globalProperties.$copyText(this.selectCache).then(()=>{e.add(S.INFO,this.$t("复制成功"),!0)},()=>{e.add(S.ERR,this.$t("复制失败"),!0)})}this.closeMsgMenu()},async copyImg(){const e=this.tags.menuDisplay.downloadImg;if(!e)return;this.closeMsgMenu();const{blob:t,buffer:a}=await je(e),s=new R;if(B.type==="tauri")try{await(await ue(()=>import("./@tauri-apps-CZq0uPQG.js").then(u=>u.i),[])).writeImage(a),s.add(S.INFO,this.$t("复制成功"))}catch(o){s.add(S.ERR,this.$t("复制失败")),new U().error(o,"复制图片失败")}else{const o=new ClipboardItem({[t.type]:t});try{await Ee([o]),s.add(S.INFO,this.$t("复制成功"))}catch(u){s.add(S.ERR,this.$t("复制失败")),new U().error(u,"复制图片失败")}}},downloadImg(){const e=this.tags.menuDisplay.downloadImg;e!=!1&&Fe(e,"img.png",()=>{},()=>{}),this.closeMsgMenu()},revokeMsg(){const e=this.selectedMsg;if(e!==null){const t=e.message_id;C.send("delete_msg",{message_id:t},"deleteMsg"),this.closeMsgMenu()}},removeUser(){const e=this.selectedMsg;if(e!==null){const t={title:this.$t("提醒"),html:`<span>${this.$t("真的要将 {user} 移出群聊吗",{user:e.sender.nickname})}</span>`,button:[{text:N.config.globalProperties.$t("确定"),fun:()=>{e&&(C.send("set_group_kick",{group_id:l.chatInfo.show.id,user_id:e.sender.user_id},"setGroupKick"),this.closeMsgMenu(),l.popBoxList.shift())}},{text:N.config.globalProperties.$t("取消"),master:!0,fun:()=>{l.popBoxList.shift()}}]};l.popBoxList.push(t)}},closeMsgMenu(){this.tags.showMsgMenu=!1,this.tags.menuDisplay.menuSelectedMsgId=null,setTimeout(()=>{this.initMenuDisplay()},300)},openChatInfoPan(){var e;if(this.tags.openChatInfo=!this.tags.openChatInfo,this.tags.openChatInfo){if(this.chat.show.type==="group"&&this.chat.info.group_info.gc!==this.chat.show.id){const a=`https://qinfo.clt.qq.com/cgi-bin/qun_info/get_group_info_all?gc=${this.chat.show.id}&bkn=${l.loginInfo.bkn}`;C.send("http_proxy",{url:a},"getMoreGroupInfo")}else if(this.chat.show.type==="user"&&this.chat.info.user_info.uin!==this.chat.show.id){const a=l.jsonMap.friend_info.name;a!=null&&C.send(a,{user_id:this.chat.show.id},"getMoreUserInfo")}const t=l.jsonMap.group_notices.name;if(this.chat.show.type==="group"&&(this.chat.info.group_notices===void 0||Object.keys(this.chat.info.group_notices).length===0)&&t&&C.send(t,{group_id:this.chat.show.id},"getGroupNotices"),this.chat.show.type==="group"&&Object.keys(this.chat.info.group_files).length===0){const a=(e=l.jsonMap.group_files)==null?void 0:e.name;a&&C.send(a,{group_id:this.chat.show.id},"getGroupFiles")}}},deleteImg(e){this.imgCache.delete(e),this.msg=this.msg.replace("[SQ:"+e+"]",""),this.msg=this.msg.replace("[SQ:"+e,"")},async editImg(e){const t=this.imgCache.get(e);if(!t||!this.viewer)return;const a=await this.viewer.edit(t);this.imgCache.set(e,a)},addSpecialMsg(e){const t=document.getElementById("main-input");if(e!==void 0){const a=this.sendCache.length;if(this.sendCache.push(e.msgObj),e.addText===!0)if(e.addTop===!0)this.msg="[SQ:"+a+"]"+this.msg;else{const s=t.selectionStart;if(s!=null){const o=this.msg.substring(0,s),u=this.msg.substring(s,this.msg.length);this.msg=o+"[SQ:"+a+"]"+u}else this.msg+="[SQ:"+a+"]"}return a}return-1},addImg(e){if(e.clipboardData&&e.clipboardData.items)for(let t=0,a=e.clipboardData.items.length;t<a;t++){const s=e.clipboardData.items[t];s.kind==="file"&&(this.setImg(s.getAsFile()),e.preventDefault())}},runSelectImg(){const e=document.getElementById("choice-pic");e&&e.click()},selectImg(e){this.tags.showMoreDetail=!1;const t=e.target;t&&t.files&&this.setImg(t.files[0])},runSelectFile(){const e=document.getElementById("choice-file");e&&e.click()},selectFile(e){this.tags.showMoreDetail=!1;const t=e.target;if(t.files!=null){const a=t.files[0],s=a.name;if(a.size>1073741824){const u={title:this.$t("提醒"),html:`<span>${this.$t("文件大于 1GB。发送速度可能会非常缓慢；确认要发送吗？")}</span>`,button:[{text:this.$t("发送"),fun:()=>{l.popBoxList.shift()}},{text:this.$t("取消"),master:!0,fun:()=>{l.popBoxList.shift()}}]};l.popBoxList.push(u)}else this.sendFile(a,s);t.value=""}},sendFile(e,t){const a=new FileReader;a.readAsDataURL(e),a.onloadend=()=>{let s=a.result;s=s.substring(s.indexOf("base64,")+7,s.length),this.sendCache=[],this.imgCache.clear(),this.msg="",this.addSpecialMsg({addText:!0,msgObj:{type:"file",file:"base64://"+s,name:t??this.$t("未知文件")}}),this.sendMsg("sendFileBack");const o={title:this.$t("提醒"),html:`<span>${this.$t("正在发送文件中……")}</span>`,allowClose:!1};l.popBoxList.push(o)}},async setImg(e){const t=new R;if(!e||!e.type.includes("image/")||e.size===0)return;if(e.size>3145728){const o={maxSizeMB:3,useWebWorker:!0};try{t.add(S.INFO,this.$t("正在压缩图片 ……"));const u=await Ae(e,o);new U().add(J.INFO,"图片压缩成功，原大小："+e.size/1024/1024+" MB，压缩后大小："+u.size/1024/1024+" MB"),this.setImg(u)}catch(u){new U().error(u,"图片压缩失败"),t.add(S.INFO,this.$t("压缩图片失败"))}return}const a=this.sendCache.length,s={type:"text",text:`[${this.$t("图片")}]`};this.addSpecialMsg({addText:!0,msgObj:s}),this.imgCache.set(a,await this.fileToDataURL(e))},async fileToDataURL(e){return new Promise((t,a)=>{const s=new FileReader;s.onload=function(o){o.target?t(o.target.result):a(new Error("读取文件失败"))},s.onerror=function(o){a(o)},s.readAsDataURL(e)})},toMainInput(){const e=document.getElementById("main-input");e!==null&&e.focus()},sendMsg(e="sendMsgBack"){if(this.details[3].open)return;this.details.forEach(a=>{a.open=!1});for(const[a,s]of this.imgCache)this.sendCache[a]={type:"image",file:"base64://"+s.substring(s.indexOf("base64,")+7,s.length)};const t=de.parseMsg(this.msg,this.sendCache,[]);this.chat.show.temp?W(this.chat.show.id+"/"+this.chat.show.temp,this.chat.show.type,t,!0,e):W(this.chat.show.id,this.chat.show.type,t,!0,e),this.tags.checkNewLineFlag=!0,this.msg="",this.sendCache=[],this.imgCache.clear(),this.scrollBottom(),this.cancelReply()},updateList(e,t){var s,o;if(t==0&&e>0){const u=((s=l.jsonMap.set_message_read)==null?void 0:s.name)??void 0;let p=((o=l.jsonMap.set_message_read)==null?void 0:o.private_name)??u;p||(p=u),l.chatInfo.show.type=="group"?C.send(u,{group_id:this.chat.show.id,message_id:this.list[this.list.length-1].message_id},"setMessageRead"):C.send(p,{user_id:this.chat.show.id,message_id:this.list[this.list.length-1].message_id},"setMessageRead"),De()&&this.toMainInput()}if(this.tags.showBottomButton&&!this.tags.nowGetHistroy&&t>0&&(this.NewMsgNum!==0?this.NewMsgNum=this.NewMsgNum+Math.abs(e-t):this.NewMsgNum=Math.abs(e-t)),this.list.length>200&&!this.tags.nowGetHistroy&&!this.tags.showBottomButton){l.messageList=[];const u={type:this.chat.show.type,id:this.chat.show.id,name:this.chat.show.name,avatar:this.chat.show.avatar,jump:this.chat.show.jump};Be(u),this.tags.nowGetHistroy=!0}const a=document.getElementById("msgPan");if(a!==null){const u=a.scrollHeight;this.$nextTick(()=>{const p=document.getElementById("msgPan");p!==null&&(this.tags.nowGetHistroy&&this.scrollTo(p.scrollHeight-u,!1),this.tags.nowGetHistroy||(this.tags.showBottomButton||this.scrollTo(p.scrollHeight),t<=0&&this.scrollTo(p.scrollHeight,!1)),this.tags.nowGetHistroy=!1);const n=[];this.list.forEach(y=>{y.message!==void 0&&y.message.forEach(g=>{g.type==="image"&&g.file!="marketface"&&n.push(g.url)})}),this.chatImg=Te.fromList(n),l.chatInfo.show&&l.chatInfo.show.jump&&(new U().debug("进入跳转至消息："+l.chatInfo.show.jump),this.scrollToMsg("chat-"+l.chatInfo.show.jump),l.chatInfo.show.jump=void 0)})}},msgClick(e,t){const a=t.message_id;this.multipleSelectList.length>0&&(this.multipleSelectList.indexOf(a)>-1?this.multipleSelectList=this.multipleSelectList.filter(s=>s!=a):this.multipleSelectList.push(a))},delMsgs(){new R().add(S.INFO,this.$t("欸嘿，这个按钮只是用来占位置的"))},copyMsgs(){const e=this.list.filter(o=>this.multipleSelectList.indexOf(o.message_id)>-1);let t="",a="";e.forEach(o=>{const u=new Date(Le(o.time)),p=u.getFullYear()+"-"+(u.getMonth()+1)+"-"+u.getDate();p!=a&&(t+=`
—— `+p+` ——
`,a=p),t+=o.sender.nickname+" "+u.getHours()+":"+u.getMinutes()+":"+u.getSeconds()+`
`+_(o)+`

`});const s=new R;N.config.globalProperties.$copyText(t).then(()=>{s.add(S.INFO,this.$t("复制成功"),!0),this.multipleSelectList=[]},()=>{s.add(S.ERR,this.$t("复制失败"),!0)})},showJin(){if(this.details[2].open=!this.details[2].open,l.chatInfo.info.jin_info.list.length==0){const e=l.jsonMap.group_essence.name??"get_essence_msg_list";C.send(e,{group_id:this.chat.show.id,pages:0},"getJin")}this.tags.showMoreDetail=!this.tags.showMoreDetail},handleInput(e){const t=e.target,a=Number(getComputedStyle(t).marginTop.replace("px",""));t.style.height="auto",t.style.height=t.scrollHeight-a*2+"px";const s=Se(this.msg,this.oldMsg);let{end:o,str:u}={end:0,str:""};if(s.length>0&&({end:o,str:u}=s[0]),u.indexOf("]")>=0){const p=this.oldMsg.substring(0,o).lastIndexOf("[SQ:");if(p>=0&&p<o){const n=this.oldMsg.substring(p),g=this.oldMsg.slice(p,n.indexOf("]")+p+1).replace("[SQ:","").replace("]",""),v=Number(g);!isNaN(v)&&this.imgCache.has(v)&&this.deleteImg(v)}}if(this.details[3].open){const p=t.value;p.length==0?this.tags.search.list=Y(this.list):p.length>0&&(this.tags.search.list=this.list.filter(n=>_(n).indexOf(p)!==-1))}},openSearch(){this.details[3].open=!this.details[3].open,this.tags.showMoreDetail=!this.tags.showMoreDetail},closeSearch(){this.details[3].open=!this.details[3].open,this.msg="",this.tags.search.list=Y(this.list)},sendPoke(e){if(l.jsonMap.poke){let t=l.jsonMap.poke.name;this.chat.show.type=="user"&&l.jsonMap.poke.private_name&&(t=l.jsonMap.poke.private_name),C.send(t,{user_id:e,group_id:this.chat.show.id},"sendPoke")}this.tags.showMoreDetail=!1,this.tags.menuDisplay.poke=!1},jinScroll(e){const t=e.target;if(t.scrollTop+t.clientHeight===t.scrollHeight&&!this.tags.isJinLoading&&this.chat.info.jin_info.is_end==!1){this.tags.isJinLoading=!0;const a=l.jsonMap.group_essence.name??"get_essence_msg_list";C.send(a,{group_id:this.chat.show.id,pages:this.chat.info.jin_info.pages+1},"getJin")}},moreFunClick(e="default"){let t=!1;if(this.details.forEach(a=>{a.open&&(t=!0),a.open=!1}),!t){if(this.tags.showMoreDetail){this.tags.showMoreDetail=!1;return}switch(e){case"default":this.tags.showMoreDetail=!0;break;case"img":this.runSelectImg();break;case"file":this.runSelectFile();break;case"face":this.details[1].open=!this.details[1].open;break}}},openLeftBar(){l.tags.openSideBar=!l.tags.openSideBar},getTargetWin(){const e=document.getElementById("chat-pan");if(!e)return;const t=this.$refs.mergePan;return this.tags.openChatInfo?e.getElementsByClassName("chat-info-pan")[0]:t!=null&&t.isMergeOpen()?e.getElementsByClassName("merge-pan")[0]:e},exitWin(){const e=this.$refs.mergePan;this.tags.openChatInfo?this.openChatInfoPan():e!=null&&e.isMergeOpen()?(e==null||e.closeMergeMsg(),setTimeout(()=>{const a=document.getElementById("chat-pan").getElementsByClassName("merge-pan")[0];a&&(a.style.transform="")},500)):(l.chatInfo.show.id=0,l.tags.openSideBar=!0,new U().add(J.UI,"右滑打开侧边栏触发完成"))}}}),Ei=O({...ji,setup(e){const t=qe({user:void 0,x:0,y:0}),a={open:(s,o,u)=>{s.level!=null&&(t.user=s,t.x=o,t.y=u)},close:()=>{t.user=void 0}};return(s,o)=>{var p;const u=D("font-awesome-icon");return w((r(),h("div",{id:"chat-pan",class:I("chat-pan"+(k(l).tags.openSideBar?" open":"")+(["linux","win32"].includes(k(B).platform??"")?" withBar":"")),style:te(`background-image: url(${k(l).sysConfig.chat_background});`),onVMoveRight:o[52]||(o[52]=me(n=>s.exitWin(),["prevent"]))},[i("div",Kt,[m(u,{icon:["fas","bars-staggered"],onClick:s.openLeftBar},null,8,["onClick"]),i("img",{src:s.chat.show.avatar},null,8,Vt),i("div",Jt,[i("p",null,[E(d(s.chat.show.name)+" ",1),k(l).chatInfo.show.type=="group"?(r(),h($,{key:0},[E(" ("+d(k(l).chatInfo.info.group_members.length)+") ",1)],64)):f("",!0)]),s.chat.show.temp?(r(),h("span",Qt,d(s.$t("来自群聊：{group}",{group:s.chat.show.temp})),1)):(r(),h("span",Yt,[s.chat.show.appendInfo?(r(),h($,{key:0},[E(d(s.chat.show.appendInfo),1)],64)):(r(),h($,{key:1},[E(d(s.list[s.list.length-1]?s.$t("上次消息 - {time}",{time:Intl.DateTimeFormat(s.trueLang,{hour:"numeric",minute:"numeric",second:"numeric"}).format(new Date(s.list[s.list.length-1].time*1e3))}):s.$t("暂无消息")),1)],64))]))]),o[53]||(o[53]=i("div",{class:"space"},null,-1)),i("div",Xt,[m(u,{icon:["fas","ellipsis-vertical"],onClick:s.openChatInfoPan},null,8,["onClick"])])]),i("div",{class:I("loading"+(s.tags.nowGetHistroy&&k(l).tags.canLoadHistory?" show":""))},[m(u,{icon:["fas","spinner"]}),i("span",null,d(s.$t("加载中")),1)],2),s.details[3].open?(r(),h("div",ei,[m(se,{name:k(l).sysConfig.opt_fast_animation?"":"msglist",tag:"div"},{default:j(()=>[(r(!0),h($,null,L(s.tags.search.list,(n,y)=>(r(),h($,null,[k(X)(s.list[y-1]?s.list[y-1].time:void 0,n.time)?(r(),M(A,{key:"notice-time-"+y,data:{sub_type:"time",time:n.time}},null,8,["data"])):f("",!0),(n.post_type==="message"||n.post_type==="message_sent")&&n.message.length>0?(r(),M(V,{key:n.fake_message_id??n.message_id,selected:s.multipleSelectList.includes(n.message_id)||s.tags.menuDisplay.menuSelectedMsgId==n.message_id,data:n,"user-info-pan":a,onScrollToMsg:k(ee),onShowMenu:s.showMsgMeun,onImageLoaded:s.imgLoadedScroll,onLeftMove:s.replyMsg},null,8,["selected","data","onScrollToMsg","onShowMenu","onImageLoaded","onLeftMove"])):f("",!0)],64))),256))]),_:1},8,["name"])])):(r(),h("div",{key:0,id:"msgPan",class:"chat",style:{"scroll-behavior":"smooth"},onScroll:o[0]||(o[0]=(...n)=>s.chatScroll&&s.chatScroll(...n))},[k(l).tags.canLoadHistory?f("",!0):(r(),h("div",Zt,[o[54]||(o[54]=i("hr",null,null,-1)),i("a",null,d(s.$t("没有更多消息了")),1)])),k(l).tags.loadHistoryFail?(r(),h("div",xt,[o[55]||(o[55]=i("hr",null,null,-1)),i("a",null,d(s.$t("获取历史记录失败")),1)])):f("",!0),s.tags.nowGetHistroy&&s.list.length>0?(r(),M(A,{key:2,data:{sub_type:"time",time:s.list[0].time}},null,8,["data"])):f("",!0),m(se,{name:k(l).sysConfig.opt_fast_animation?"":"msglist",tag:"div"},{default:j(()=>[(r(!0),h($,null,L(s.list,(n,y)=>(r(),h($,null,[k(X)(s.list[y-1]?s.list[y-1].time:void 0,n.time)?(r(),M(A,{key:"notice-time-"+(n.time/(4*60)).toFixed(0),data:{sub_type:"time",time:n.time}},null,8,["data"])):f("",!0),k(oe)(n)?(r(),M(A,{key:"delete-"+n.message_id,data:{sub_type:"delete"}})):(n.post_type==="message"||n.post_type==="message_sent")&&n.message.length>0?(r(),M(V,{key:n.fake_message_id??n.message_id,selected:s.multipleSelectList.includes(n.message_id)||s.tags.menuDisplay.menuSelectedMsgId==n.message_id,data:n,"user-info-pan":a,"image-list-header":s.chatImg,onClick:g=>s.msgClick(g,n),onShowMenu:s.showMsgMeun,onScrollToMsg:k(ee),onImageLoaded:s.imgLoadedScroll,onLeftMove:s.replyMsg,onSendPoke:s.sendPoke},null,8,["selected","data","image-list-header","onClick","onShowMenu","onScrollToMsg","onImageLoaded","onLeftMove","onSendPoke"])):n.post_type==="notice"?(r(),M(A,{id:k(le)(),key:"notice-"+y,data:n},null,8,["id","data"])):f("",!0)],64))),256))]),_:1},8,["name"])],32)),w(i("div",{class:"new-msg",onClick:o[1]||(o[1]=n=>s.scrollBottom(!0))},[i("div",si,[m(u,{icon:["fas","comment"]}),s.NewMsgNum>0?(r(),h("span",ti,d(s.NewMsgNum),1)):f("",!0)])],512),[[b,s.tags.showBottomButton]]),i("div",ii,[i("div",null,[i("div",null,[m(H,{name:"pan"},{default:j(()=>[w(m(Bt,{onAddSpecialMsg:s.addSpecialMsg,onSendMsg:s.sendMsg},null,8,["onAddSpecialMsg","onSendMsg"]),[[b,s.details[1].open]])]),_:1}),m(H,{name:"pan"},{default:j(()=>[w(i("div",ni,[i("div",null,[m(u,{icon:["fas","message"]}),i("span",null,d(s.$t("精华消息")),1),m(u,{icon:["fas","xmark"],onClick:o[2]||(o[2]=n=>s.details[2].open=!s.details[2].open)})]),i("div",{class:"jin-pan-body",onScroll:o[3]||(o[3]=(...n)=>s.jinScroll&&s.jinScroll(...n))},[(r(!0),h($,null,L(k(l).chatInfo.info.jin_info.list,(n,y)=>(r(),h("div",{key:"jin-"+y},[i("div",null,[i("img",{src:`https://q1.qlogo.cn/g?b=qq&s=0&nk=${n.sender_uin}`},null,8,oi),i("div",null,[i("a",null,d(n.sender_nick),1),i("span",null,d(Intl.DateTimeFormat(s.trueLang,{hour:"numeric",minute:"numeric"}).format(new Date(n.sender_time*1e3)))+" "+d(s.$t("发送")),1)]),i("span",null,d(s.$t("{time}，由 {name} 设置",{time:Intl.DateTimeFormat(s.trueLang,{hour:"numeric",minute:"numeric"}).format(new Date(n.sender_time*1e3)),name:n.add_digest_nick})),1)]),i("div",ai,[(r(!0),h($,null,L(n.msg_content,(g,v)=>(r(),h($,{key:"jinc-"+y+"-"+v},[g.type==="text"?(r(),h("span",li,d(g.data.text),1)):f("",!0),g.type==="face"?(r(),M(ie,{key:1,emoji:k(z).get(Number(g.data.id))},null,8,["emoji"])):f("",!0),g.type==="image"?(r(),h("img",{key:2,src:g.data.url},null,8,ri)):f("",!0)],64))),128))])]))),128)),w(i("div",di,[m(u,{icon:["fas","spinner"]})],512),[[b,s.tags.isJinLoading]])],32)],512),[[b,s.details[2].open&&k(l).chatInfo.info.jin_info.list.length>0]])]),_:1})]),i("div",{class:I(s.multipleSelectList.length>0?"select-tag show":"select-tag")},[i("div",null,[m(u,{icon:["fas","share"],onClick:s.showForWard},null,8,["onClick"]),i("span",null,d(s.$t("合并转发")),1)]),i("div",null,[m(u,{icon:["fas","scissors"]}),i("span",null,d(s.$t("截图")),1)]),i("div",null,[m(u,{icon:["fas","trash-can"],onClick:s.delMsgs},null,8,["onClick"]),i("span",null,d(s.$t("删除")),1)]),i("div",null,[m(u,{icon:["fas","copy"],onClick:s.copyMsgs},null,8,["onClick"]),i("span",null,d(s.$t("复制")),1)]),i("div",null,[i("span",{onClick:o[4]||(o[4]=n=>s.multipleSelectList=[])},d(s.multipleSelectList.length),1),i("span",null,d(s.$t("取消")),1)])],2),m(H,{name:"img-pan"},{default:j(()=>[w(i("div",{class:I({"img-pan":!0,"ss-card":!0}),onWheel:o[5]||(o[5]=n=>n.currentTarget.scrollLeft+=n.deltaY)},[i("div",ui,[(r(!0),h($,null,L(s.imgCache,([n,y])=>(r(),h("div",{key:"imgCache-"+n},[i("div",hi,[i("div",{onClick:g=>s.editImg(n)},[m(u,{icon:["fas","pencil"]})],8,mi),o[56]||(o[56]=i("hr",null,null,-1)),i("div",{onClick:g=>s.deleteImg(n)},[m(u,{style:{color:"var(--color-red)"},icon:["fas","xmark"]})],8,pi)]),i("div",gi,[i("img",{src:y,alt:`[SQ:${n}]`},null,8,fi)]),i("span",null,"#"+d(n),1)]))),128))])],544),[[b,s.imgCache.size>0]])]),_:1}),i("div",{class:I(s.details[3].open?"search-tag show":"search-tag")},[m(u,{icon:["fas","search"]}),i("span",null,d(s.$t("搜索已加载的消息")),1),i("div",{onClick:o[6]||(o[6]=(...n)=>s.closeSearch&&s.closeSearch(...n))},[m(u,{icon:["fas","xmark"]})])],2),i("div",{class:I(s.tags.isReply?"replay-tag show":"replay-tag")},[m(u,{icon:["fas","reply"]}),i("span",null,d(s.selectedMsg===null?"":s.selectedMsg.sender.nickname+": "+s.fun.getMsgRawTxt(s.selectedMsg)),1),i("div",{onClick:o[7]||(o[7]=(...n)=>s.cancelReply&&s.cancelReply(...n))},[m(u,{icon:["fas","xmark"]})])],2),i("div",{class:I(s.atFindList!=null?"at-tag show":"at-tag"),contenteditable:"true",onBlur:o[8]||(o[8]=n=>s.choiceAt(void 0))},[(r(!0),h($,null,L(s.atFindList!=null?s.atFindList:[],(n,y)=>(r(),h("div",{key:"atFind-"+n.user_id,class:I({selected:y===s.atSelectedIndex}),onClick:g=>s.choiceAt(n.user_id)},[i("img",{src:"https://q1.qlogo.cn/g?b=qq&s=0&nk="+n.user_id},null,8,yi),i("span",null,d(n.card!=""&&n.card!=null?n.card:n.nickname),1),i("a",null,d(n.user_id),1)],10,ci))),128)),((p=s.atFindList)==null?void 0:p.length)==0?(r(),h("div",wi,[i("span",null,d(s.$t("没有找到匹配的群成员")),1)])):f("",!0)],34),i("div",{class:I(s.tags.showMoreDetail?"more-detail show":"more-detail")},[i("div",{title:s.$t("图片"),onClick:o[10]||(o[10]=(...n)=>s.runSelectImg&&s.runSelectImg(...n))},[m(u,{icon:["fas","image"]}),i("input",{id:"choice-pic",type:"file",style:{display:"none"},onChange:o[9]||(o[9]=(...n)=>s.selectImg&&s.selectImg(...n))},null,32)],8,ki),i("div",{title:s.$t("文件"),onClick:o[12]||(o[12]=(...n)=>s.runSelectFile&&s.runSelectFile(...n))},[m(u,{icon:["fas","folder"]}),i("input",{id:"choice-file",type:"file",style:{display:"none"},onChange:o[11]||(o[11]=(...n)=>s.selectFile&&s.selectFile(...n))},null,32)],8,$i),i("div",{title:s.$t("表情"),onClick:o[13]||(o[13]=n=>(s.details[1].open=!s.details[1].open,s.tags.showMoreDetail=!1))},[m(u,{icon:["fas","face-laugh"]})],8,vi),s.chat.show.type==="user"?(r(),h("div",{key:0,title:s.$t("戳一戳"),onClick:o[14]||(o[14]=n=>s.sendPoke(s.chat.show.id))},[m(u,{icon:["fas","fa-hand-point-up"]})],8,Mi)):f("",!0),s.chat.show.type==="group"?(r(),h("div",{key:1,title:s.$t("精华消息"),onClick:o[15]||(o[15]=(...n)=>s.showJin&&s.showJin(...n))},[m(u,{icon:["fas","star"]})],8,bi)):f("",!0),o[57]||(o[57]=i("div",{class:"space"},null,-1)),i("div",{title:s.$t("搜索消息"),onClick:o[16]||(o[16]=(...n)=>s.openSearch&&s.openSearch(...n))},[m(u,{icon:["fas","search"]})],8,Ci)],2)]),i("div",null,[w((r(),h("div",{onClick:o[17]||(o[17]=n=>s.moreFunClick(k(l).sysConfig.quick_send))},[s.tags.showMoreDetail||s.details.find(n=>n.open)?(r(),M(u,{key:0,icon:["fas","minus"]})):k(l).sysConfig.quick_send=="default"?(r(),M(u,{key:1,icon:["fas","plus"]})):k(l).sysConfig.quick_send=="img"?(r(),M(u,{key:2,icon:["fas","image"]})):k(l).sysConfig.quick_send=="file"?(r(),M(u,{key:3,icon:["fas","folder"]})):k(l).sysConfig.quick_send=="face"?(r(),M(u,{key:4,icon:["fas","face-laugh"]})):f("",!0)])),[[k(Ie),n=>s.moreFunClick(),void 0,{prevent:!0}]]),i("div",null,[i("form",{onSubmit:o[31]||(o[31]=(...n)=>s.mainSubmit&&s.mainSubmit(...n))},[k(K).get("use_breakline")?w((r(),h("textarea",{key:1,id:"main-input","onUpdate:modelValue":o[23]||(o[23]=n=>s.msg=n),type:"text",disabled:k(l).tags.openSideBar,onPaste:o[24]||(o[24]=(...n)=>s.addImg&&s.addImg(...n)),onKeydown:o[25]||(o[25]=(...n)=>s.mainKey&&s.mainKey(...n)),onKeyup:o[26]||(o[26]=(...n)=>s.mainKeyUp&&s.mainKeyUp(...n)),onClick:o[27]||(o[27]=(...n)=>s.selectSQIn&&s.selectSQIn(...n)),onInput:o[28]||(o[28]=(...n)=>s.handleInput&&s.handleInput(...n)),onCompositionstart:o[29]||(o[29]=(...n)=>s.handleCompositionStart&&s.handleCompositionStart(...n)),onCompositionend:o[30]||(o[30]=(...n)=>s.handleCompositionEnd&&s.handleCompositionEnd(...n))},null,40,Si)),[[q,s.msg]]):w((r(),h("input",{key:0,id:"main-input","onUpdate:modelValue":o[18]||(o[18]=n=>s.msg=n),type:"text",autocomplete:"off",disabled:k(l).tags.openSideBar||s.chat.info.me_info.shut_up_timestamp>0,placeholder:s.chat.info.me_info.shut_up_timestamp>0?s.$t("已被禁言至：{time}",{time:Intl.DateTimeFormat(s.trueLang,k(ne)(new Date(s.chat.info.me_info.shut_up_timestamp*1e3))).format(new Date(s.chat.info.me_infotimestamp*1e3))}):"",onPaste:o[19]||(o[19]=(...n)=>s.addImg&&s.addImg(...n)),onKeyup:o[20]||(o[20]=(...n)=>s.mainKeyUp&&s.mainKeyUp(...n)),onClick:o[21]||(o[21]=(...n)=>s.selectSQIn&&s.selectSQIn(...n)),onInput:o[22]||(o[22]=(...n)=>s.handleInput&&s.handleInput(...n))},null,40,Ii)),[[q,s.msg]])],32),i("div",{onClick:o[32]||(o[32]=n=>s.sendMsg("sendMsgBack"))},[s.details[3].open?(r(),M(u,{key:0,icon:["fas","search"]})):(r(),M(u,{key:1,icon:["fas","angle-right"]}))])])]),o[58]||(o[58]=i("div",null,null,-1))]),m(Nt,{ref:"mergePan"},null,512),m(zt,{data:k(t)},null,8,["data"]),(r(),M(pe,{to:"body"},[i("div",{class:I("msg-menu"+(["linux","win32"].includes(k(B).platform??"")?" withBar":""))},[w(i("div",{class:"msg-menu-bg",onClick:o[33]||(o[33]=(...n)=>s.closeMsgMenu&&s.closeMsgMenu(...n))},null,512),[[b,s.tags.showMsgMenu]]),i("div",{id:"msgMenu",class:I(s.tags.showMsgMenu?"ss-card msg-menu-body show":"ss-card msg-menu-body")},[k(l).chatInfo.show.type=="group"?w((r(),h("div",{key:0,class:I("ss-card respond"+(s.tags.menuDisplay.respond?" open":""))},[(r(!0),h($,null,L(k(z).responseId,(n,y)=>(r(),h($,{key:"respond-"+n},[m(ie,{emoji:k(z).get(n),onClick:g=>s.sendRespond(n)},null,8,["emoji","onClick"]),y==4?(r(),M(u,{key:0,icon:["fas","angle-up"],onClick:o[34]||(o[34]=g=>s.tags.menuDisplay.respond=!0)})):f("",!0)],64))),128))],2)),[[b,s.tags.menuDisplay.showRespond]]):f("",!0),w(i("div",{onClick:o[35]||(o[35]=n=>s.forwardSelf())},[i("div",null,[m(u,{icon:["fas","plus"]})]),i("a",null,d(s.$t("+ 1")),1)],512),[[b,s.tags.menuDisplay.add]]),w(i("div",{onClick:o[36]||(o[36]=n=>s.menuReplyMsg(!0))},[i("div",null,[m(u,{icon:["fas","message"]})]),i("a",null,d(s.$t("回复")),1)],512),[[b,s.tags.menuDisplay.relpy]]),w(i("div",{onClick:o[37]||(o[37]=n=>s.showForWard())},[i("div",null,[m(u,{icon:["fas","share"]})]),i("a",null,d(s.$t("转发")),1)],512),[[b,s.tags.menuDisplay.forward]]),w(i("div",{onClick:o[38]||(o[38]=n=>s.intoMultipleSelect())},[i("div",null,[m(u,{icon:["fas","circle-check"]})]),i("a",null,d(s.$t("多选")),1)],512),[[b,s.tags.menuDisplay.select]]),w(i("div",{onClick:o[39]||(o[39]=(...n)=>s.copyMsg&&s.copyMsg(...n))},[i("div",null,[m(u,{icon:["fas","clipboard"]})]),i("a",null,d(s.$t("复制")),1)],512),[[b,s.tags.menuDisplay.copy]]),w(i("div",{onClick:o[40]||(o[40]=(...n)=>s.copySelectMsg&&s.copySelectMsg(...n))},[i("div",null,[m(u,{icon:["fas","code"]})]),i("a",null,d(s.$t("复制选中文本")),1)],512),[[b,s.tags.menuDisplay.copySelect]]),w(i("div",{onClick:o[41]||(o[41]=(...n)=>s.copyImg&&s.copyImg(...n))},[i("div",null,[m(u,{icon:["fas","object-ungroup"]})]),i("a",null,d(s.$t("复制图片")),1)],512),[[b,s.tags.menuDisplay.copyImg]]),w(i("div",{onClick:o[42]||(o[42]=(...n)=>s.downloadImg&&s.downloadImg(...n))},[i("div",null,[m(u,{icon:["fas","floppy-disk"]})]),i("a",null,d(s.$t("下载图片")),1)],512),[[b,s.tags.menuDisplay.downloadImg!=!1]]),w(i("div",{onClick:o[43]||(o[43]=(...n)=>s.revokeMsg&&s.revokeMsg(...n))},[i("div",null,[m(u,{icon:["fas","xmark"]})]),i("a",null,d(s.$t("撤回")),1)],512),[[b,s.tags.menuDisplay.revoke]]),w(i("div",{onClick:o[44]||(o[44]=n=>{s.selectedMsg&&s.addSpecialMsg({msgObj:{type:"at",qq:s.selectedMsg.sender.user_id},addText:!0}),s.toMainInput(),s.closeMsgMenu()})},[i("div",null,[m(u,{icon:["fas","at"]})]),i("a",null,d(s.$t("提及")),1)],512),[[b,s.tags.menuDisplay.at]]),w(i("div",{onClick:o[45]||(o[45]=n=>s.sendPoke(s.selectedMsg?s.selectedMsg.sender.user_id:void 0))},[i("div",null,[m(u,{icon:["fas","fa-hand-point-up"]})]),i("a",null,d(s.$t("戳一戳")),1)],512),[[b,s.tags.menuDisplay.poke]]),w(i("div",{onClick:o[46]||(o[46]=(...n)=>s.removeUser&&s.removeUser(...n))},[i("div",null,[m(u,{icon:["fas","trash-can"]})]),i("a",null,d(s.$t("移出群聊")),1)],512),[[b,s.tags.menuDisplay.remove]]),w(i("div",{onClick:o[47]||(o[47]=n=>{var y;s.openChatInfoPan(),s.$refs.infoRef.openMoreConfig((y=s.selectedMsg)==null?void 0:y.sender.user_id),s.closeMsgMenu()})},[i("div",null,[m(u,{icon:["fas","cog"]})]),i("a",null,d(s.$t("成员设置")),1)],512),[[b,s.tags.menuDisplay.config]]),w(i("div",{onClick:o[48]||(o[48]=(...n)=>s.jumpSearchMsg&&s.jumpSearchMsg(...n))},[i("div",null,[m(u,{icon:["fas","arrow-up-right-from-square"]})]),i("a",null,d(s.$t("跳转到消息")),1)],512),[[b,s.tags.menuDisplay.jumpToMsg]]),w(i("div",{onClick:o[49]||(o[49]=(...n)=>s.consoleLogMsg&&s.consoleLogMsg(...n))},[i("div",null,[m(u,{icon:["fas","screwdriver-wrench"]})]),i("a",null,d(s.$t("调试信息")),1)],512),[[b,s.isDev]])],2)],2)])),m(H,null,{default:j(()=>[m(Zs,{ref:"infoRef",chat:s.chat,tags:s.tags,onClose:s.openChatInfoPan},null,8,["chat","tags","onClose"])]),_:1}),m(H,null,{default:j(()=>[s.tags.showForwardPan?(r(),h("div",Li,[i("div",Di,[i("header",null,[i("span",null,d(s.$t("转发消息")),1),m(u,{icon:["fas","xmark"],onClick:s.cancelForward},null,8,["onClick"])]),i("input",{placeholder:s.$t("搜索 ……"),onInput:o[50]||(o[50]=(...n)=>s.searchForward&&s.searchForward(...n))},null,40,Bi),i("div",null,[(r(!0),h($,null,L(s.forwardList,n=>(r(),h("div",{key:"forwardList-"+n.user_id?n.user_id:n.group_id,onClick:y=>s.forwardMsg(n)},[i("img",{loading:"lazy",title:k(he)(n.group_name||n.nickname,n.remark),src:n.user_id?"https://q1.qlogo.cn/g?b=qq&s=0&nk="+n.user_id:"https://p.qlogo.cn/gh/"+n.group_id+"/"+n.group_id+"/0"},null,8,Fi),i("div",null,[i("p",null,d(n.group_name?n.group_name:n.remark===n.nickname?n.nickname:n.remark+"（"+n.nickname+"）"),1),i("span",null,d(n.group_id?s.$t("群组"):s.$t("好友")),1)])],8,Ti))),128))])]),i("div",{class:"bg",onClick:o[51]||(o[51]=(...n)=>s.cancelForward&&s.cancelForward(...n))})])):f("",!0)]),_:1}),i("div",{class:"bg",style:te({"backdrop-filter":`blur(${k(l).sysConfig.chat_background_blur}px)`})},null,4)],38)),[[k(Ce),s.chatMoveOptions]])}}}),kn=P(Ei,[["__scopeId","data-v-2e67f8df"]]);export{kn as default};
